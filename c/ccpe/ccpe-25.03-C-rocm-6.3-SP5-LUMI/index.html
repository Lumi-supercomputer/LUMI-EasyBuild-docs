


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the LUMI software library">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>ccpe/25.03-C-rocm-6.3-SP5-LUMI (ccpe-25.03-C-rocm-6.3-SP5-LUMI.eb) - ccpe - LUMI Software Library</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
  
      

    

  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      document.body.addEventListener("click", function(ev) {
        if (ev.target instanceof HTMLElement) {
          var el = ev.target.closest("a[href^=http]")
          if (el)
            ga("send", "event", "outbound", "click", el.href)
        }
      })
    })
  </script>

    

  
  
  
    
  

  
  

  
  <meta property="og:type" content="website" />
  <meta property="og:title" content="LUMI Software Library - ccpe/25.03-C-rocm-6.3-SP5-LUMI (ccpe-25.03-C-rocm-6.3-SP5-LUMI.eb) - ccpe" />
  <meta property="og:description" content="Documentation for the LUMI software library" />
  <meta property="og:url" content="None" />
  <meta property="og:image" content="assets/images/banner.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1080" />
  <meta property="og:image:height" content="568" />

  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@LUMIhpc" />
  <meta name="twitter:creator" content="@LUMIhpc" />
  <meta name="twitter:title" content="LUMI Software Library - ccpe/25.03-C-rocm-6.3-SP5-LUMI (ccpe-25.03-C-rocm-6.3-SP5-LUMI.eb) - ccpe" />
  <meta name="twitter:description" content="Documentation for the LUMI software library" />
  <meta name="twitter:image" content="assets/images/banner.png" />

  <style>
    [data-md-color-primary="lumi"] {
      --md-primary-fg-color: hsla(0, 0%, 100%, 1);
      --md-primary-fg-color--light: hsla(0, 0%, 100%, 0.7);
      --md-primary-fg-color--dark: hsla(0, 0%, 0%, 0.07);
      --md-primary-bg-color: hsla(0, 0%, 0%, 0.87);
      --md-primary-bg-color--light: hsla(0, 0%, 0%, 0.54);
      --md-button-bg-color: hsla(207,100%,28%, 1);
      --md-button-bg-color--light: hsla(207,100%,38%, 1);
      --md-typeset-a-color: hsla(207,100%,28%, 1);
    }
    
    [data-md-color-accent="lumi"] {
      --md-accent-fg-color: hsla(0,0%,0%, 1);
      --md-accent-fg-color--transparent: hsla(0,0%,0%, 0.1);
      --md-accent-bg-color: hsla(0, 0%, 100%, 1);
      --md-accent-bg-color--light: hsla(0, 0%, 100%, 0.7);
    }
  </style>

  


  
  

    <link
      rel="stylesheet"
      href="../../../assets/stylesheets/extra-a8af0af3d0.css"
    />
    <link
      rel="stylesheet"
      href="../../../assets/stylesheets/overrides-5193e6f6df.css"
    />
    <link
      rel="stylesheet"
      id="typekit-fonts-css"
      href="https://use.typekit.net/nlo5lta.css?ver=5.5.3"
      type="text/css" media="all"
    />

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="lumi" data-md-color-accent="lumi">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ccpe2503-c-rocm-63-sp5-lumi-ccpe-2503-c-rocm-63-sp5-lumieb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="LUMI Software Library" class="md-header__button md-logo" aria-label="LUMI Software Library" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 723 212" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g id="Layer-2" serif:id="Layer 2">
        <g transform="matrix(1,0,0,1,0,175.883)">
            <path d="M0,-140.304L0,0L102.89,0L102.89,-24.599L26.658,-24.599L26.658,-140.304L0,-140.304Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,257.262,35.5793)">
            <path d="M0,140.304C-17.585,140.304 -32.083,135.347 -43.588,125.338C-55,115.423 -60.799,103.357 -60.799,89.14L-60.799,0L-34.328,0L-34.328,81.563C-34.328,92.413 -31.054,100.645 -24.319,105.976C-17.866,111.12 -9.728,113.74 0,113.74C9.728,113.74 17.865,111.12 24.319,105.976C31.054,100.645 34.328,92.413 34.328,81.563L34.328,0L60.799,0L60.799,89.14C60.799,103.357 55.093,115.329 43.588,125.338C32.083,135.347 17.585,140.304 0,140.304" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,550.374,119.668)">
            <path d="M0,-27.874L-43.588,20.671L-87.176,-27.874L-87.176,56.215L-113.74,56.215L-113.74,-84.089L-105.695,-84.089L-43.588,-13.47L18.614,-84.089L26.658,-84.089L26.658,56.215L0.094,56.215L0,-27.874Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <rect x="695.604" y="35.486" width="26.658" height="140.397" style="fill:rgb(29,29,27);"/>
        <g transform="matrix(-1,0,0,1,722.262,-203.194)">
            <rect x="0" y="203.194" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
        <g transform="matrix(-1,0,0,1,722.262,203.194)">
            <rect x="0" y="0" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
    </g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LUMI Software Library
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ccpe/25.03-C-rocm-6.3-SP5-LUMI (ccpe-25.03-C-rocm-6.3-SP5-LUMI.eb) - ccpe
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#a" class="md-tabs__link">
        
  
  
    
  
  a

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#b" class="md-tabs__link">
        
  
  
    
  
  b

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#c" class="md-tabs__link">
        
  
  
    
  
  c

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#d" class="md-tabs__link">
        
  
  
    
  
  d

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#e" class="md-tabs__link">
        
  
  
    
  
  e

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#f" class="md-tabs__link">
        
  
  
    
  
  f

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#g" class="md-tabs__link">
        
  
  
    
  
  g

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#h" class="md-tabs__link">
        
  
  
    
  
  h

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#I/ICU" class="md-tabs__link">
        
  
  
    
  
  I/ICU

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#i" class="md-tabs__link">
        
  
  
    
  
  i

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#j" class="md-tabs__link">
        
  
  
    
  
  j

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#k" class="md-tabs__link">
        
  
  
    
  
  k

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#l" class="md-tabs__link">
        
  
  
    
  
  l

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#m" class="md-tabs__link">
        
  
  
    
  
  m

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#n" class="md-tabs__link">
        
  
  
    
  
  n

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#o" class="md-tabs__link">
        
  
  
    
  
  o

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#p" class="md-tabs__link">
        
  
  
    
  
  p

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#q" class="md-tabs__link">
        
  
  
    
  
  q

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#r" class="md-tabs__link">
        
  
  
    
  
  r

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#s" class="md-tabs__link">
        
  
  
    
  
  s

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#t" class="md-tabs__link">
        
  
  
    
  
  t

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#u" class="md-tabs__link">
        
  
  
    
  
  u

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#v" class="md-tabs__link">
        
  
  
    
  
  v

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#w" class="md-tabs__link">
        
  
  
    
  
  w

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#x" class="md-tabs__link">
        
  
  
    
  
  x

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#y" class="md-tabs__link">
        
  
  
    
  
  y

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html#z" class="md-tabs__link">
        
  
  
    
  
  z

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../known_issues/" class="md-tabs__link">
        
  
  
    
  
  Issues

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../whats_new/" class="md-tabs__link">
        
  
  
    
  
  New

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="LUMI Software Library" class="md-nav__button md-logo" aria-label="LUMI Software Library" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 723 212" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g id="Layer-2" serif:id="Layer 2">
        <g transform="matrix(1,0,0,1,0,175.883)">
            <path d="M0,-140.304L0,0L102.89,0L102.89,-24.599L26.658,-24.599L26.658,-140.304L0,-140.304Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,257.262,35.5793)">
            <path d="M0,140.304C-17.585,140.304 -32.083,135.347 -43.588,125.338C-55,115.423 -60.799,103.357 -60.799,89.14L-60.799,0L-34.328,0L-34.328,81.563C-34.328,92.413 -31.054,100.645 -24.319,105.976C-17.866,111.12 -9.728,113.74 0,113.74C9.728,113.74 17.865,111.12 24.319,105.976C31.054,100.645 34.328,92.413 34.328,81.563L34.328,0L60.799,0L60.799,89.14C60.799,103.357 55.093,115.329 43.588,125.338C32.083,135.347 17.585,140.304 0,140.304" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,550.374,119.668)">
            <path d="M0,-27.874L-43.588,20.671L-87.176,-27.874L-87.176,56.215L-113.74,56.215L-113.74,-84.089L-105.695,-84.089L-43.588,-13.47L18.614,-84.089L26.658,-84.089L26.658,56.215L0.094,56.215L0,-27.874Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <rect x="695.604" y="35.486" width="26.658" height="140.397" style="fill:rgb(29,29,27);"/>
        <g transform="matrix(-1,0,0,1,722.262,-203.194)">
            <rect x="0" y="203.194" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
        <g transform="matrix(-1,0,0,1,722.262,203.194)">
            <rect x="0" y="0" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
    </g>
</svg>

    </a>
    LUMI Software Library
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#a" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    a
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#b" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    b
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#c" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    c
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#d" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    d
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#e" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    e
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#f" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    f
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#g" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    g
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#h" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    h
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#I/ICU" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I/ICU
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#i" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    i
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#j" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    j
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#k" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    k
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#l" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    l
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#m" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    m
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#n" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    n
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#o" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    o
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#p" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    p
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#q" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    q
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#r" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    r
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#s" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    s
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#t" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    t
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#u" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    u
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#v" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#w" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    w
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#x" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    x
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#y" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    y
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#z" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    z
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../known_issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Issues
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../whats_new/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    New
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  
  




<p><a href="../">[ccpe]</a> <a href="../../../">[package list]</a></p>
<h1 id="ccpe2503-c-rocm-63-sp5-lumi-ccpe-2503-c-rocm-63-sp5-lumieb">ccpe/25.03-C-rocm-6.3-SP5-LUMI (ccpe-25.03-C-rocm-6.3-SP5-LUMI.eb)</h1>
<p>Install with the EasyBuild-user module in <code>partition/container</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>module load LUMI partition/container EasyBuild-user
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>eb ccpe-25.03-C-rocm-6.3-SP5-LUMI.eb
</code></pre></div>
The module will be available in all versions of the LUMI stack and in the CrayEnv stack.</p>
<p>To access module help after installation use <code>module spider ccpe/25.03-C-rocm-6.3-SP5-LUMI</code>.</p>
<p>EasyConfig:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Developed by Kurt Lust for LUMI</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1"># Before installing set the secret source path of the container in </span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># EASYBUILD_SOURCEPATH.</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1">#DOC This module provides a modified version of the CPE container as it comes from HPE.</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1">#DOC The goal is to integrate it better with the current LUMI environment. Changes to the</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1">#DOC container are also made through this EasyConfig, so you may use it as a template to</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1">#DOC adapt the CPE containers to your needs.</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1">#DOC</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1">#DOC This C-rocm version also integrates ROCm in the container and installs it using the </span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1">#DOC SUSE zypper install tool, guaranteeing that all dependencies are also present in</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="c1">#DOC the right version. As such, it is the most robust variant of the containers with </span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="c1">#DOC ROCm. However, installing ROCm with the unprivileged build process is extremely slow, </span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="c1">#DOC so expect long build times (over one and a half hour on a compute node),</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="c1">#DOC rendering this approach rather inefficient. The assembly of the container may also</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="c1">#DOC run out-of-memory on the login nodes as the memory available to a single user is</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="c1">#DOC restricted to 96GB.</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="c1">#DOC</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="c1">#DOC This container can be installed in `partition/container` via LUMI/24.03 or more recent</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="c1">#DOC LUMI stacks, after which the module will be available in CrayEnv and all versions of the</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="c1">#DOC LUMI stack.</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="n">easyblock</span> <span class="o">=</span> <span class="s1">&#39;MakeCp&#39;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="n">local_PRoot_version</span> <span class="o">=</span>             <span class="s1">&#39;5.4.0&#39;</span>         <span class="c1">#  https://github.com/proot-me/proot/releases</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="n">local_rocm_version</span> <span class="o">=</span>              <span class="s1">&#39;6.0.3&#39;</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="n">local_c1_rocm_version</span>     <span class="o">=</span> <span class="s1">&#39;6.3.4&#39;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="n">local_c2_rocm_version</span>     <span class="o">=</span> <span class="s1">&#39;6.2.4&#39;</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="n">local_c_rocm_major_minor</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">local_c1_rocm_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="n">name</span> <span class="o">=</span>          <span class="s1">&#39;ccpe&#39;</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="n">version</span> <span class="o">=</span>       <span class="s1">&#39;25.03&#39;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="n">versionsuffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;-C-rocm-</span><span class="si">{</span><span class="n">local_c_rocm_major_minor</span><span class="si">}</span><span class="s1">-SP5-LUMI&#39;</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="n">local_sif</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cpe-</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s1">-SP5.sif&#39;</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="n">local_ccpe_version</span> <span class="o">=</span>     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">version</span><span class="si">}{</span><span class="n">versionsuffix</span><span class="si">}</span><span class="s1"> &#39;</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="n">local_appl_lumi</span> <span class="o">=</span>        <span class="sa">f</span><span class="s1">&#39;/pfs/lustref1/appl/lumi/ccpe/appl/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">local_c_rocm_major_minor</span><span class="si">}</span><span class="s1">&#39;</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="c1">#local_appl_lumi =        f&#39;/appl/lumi&#39;</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="n">homepage</span> <span class="o">=</span> <span class="s1">&#39;https://cpe.ext.hpe.com/docs/24.11/index.html&#39;</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="n">whatis</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>    <span class="s1">&#39;Description: Containerised HPE-Cray Programming Environment&#39;</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="p">]</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="s2">This version provides the </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2"> programming environment in a container</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="s2">to start experimenting with this version before it is generally available</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="s2">on LUMI.</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="s2">This version of the container is enhanced with some additional SUSE packages</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="s2">to be more suited for development for software in the LUMI software stacks.</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="s2">The module sets the necessary bindings to be able to access regular user</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="s2">files on LUMI, to import some bits and pieces that are not in the container,</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="s2">and to be able to call Slurm from within the container.</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="s2">The module defines a number of environment variables:</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="s2">*   SIF and SIFCCPE: The full path and name of the Singularity SIF file </span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="s2">    to use with singularity exec etc.</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a><span class="s2">*   EXPORTCCPE: List of variables to export to a batch job if you want</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="s2">    to start with a clean environment yet still find back the container.</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="s2">*   SWITCHTOCCPE: To be used as `eval $SWITCHTOCCPE` at the start of a</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="s2">    job script to execute the job script in the container.</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a><span class="s2">*   SINGULARITY_BIND: Bind mounts for the container, including all LUMI</span>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="s2">    user file systems.</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="s2">*   SINGULARITYENV_PS1: A better prompt than &quot;singularity&gt;&quot; to indicate</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="s2">    that you are in the container. May be overwritten by the prompt set in</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="s2">    your ~/.bashrc or ~/.profile with ccpe-run.</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="s2">Inside the container only:</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="s2">*   INITCCPE: `eval $INITCCPE` can be used to fully re-initialise the </span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a><span class="s2">    environment in the container.</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a><span class="s2">Helper scripts outside the container to start commands in an environment</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="s2">that is not polluted by the system environment:</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a><span class="s2">*   `ccpe-shell` starts a shell in the container using `singularity shell`.</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="s2">*   `ccpe-exec` executes the command passed as arguments in the container </span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a><span class="s2">    using `singularity exec`.</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a><span class="s2">*   `ccpe-run` is another command that starts a shell which is the defined</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a><span class="s2">    behaviour for `singularity run`. This shell will read your local .bashrc.</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="s2">*   `ccpe-singularity` is a wrapper that takes all the options of the</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a><span class="s2">    regular singularity command</span>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="s2">For extensive documentation, consult the page for ccpe in the LUMI Software </span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a><span class="s2">Library.</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="n">docurls</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>    <span class="s1">&#39;https://lumi-supercomputer.github.io/LUMI-EasyBuild-docs/c/ccpe/&#39;</span><span class="p">,</span>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a><span class="p">]</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a><span class="n">toolchain</span> <span class="o">=</span> <span class="n">SYSTEM</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a><span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a>    <span class="p">{</span>
<a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a>        <span class="s1">&#39;filename&#39;</span><span class="p">:</span>    <span class="n">local_sif</span><span class="p">,</span>
<a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a>        <span class="s1">&#39;extract_cmd&#39;</span><span class="p">:</span> <span class="s1">&#39;/bin/cp -L </span><span class="si">%s</span><span class="s1"> .&#39;</span>
<a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>    <span class="p">},</span>
<a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a><span class="p">]</span>
<a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>
<a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a><span class="n">builddependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>    <span class="p">(</span><span class="s1">&#39;PRoot&#39;</span><span class="p">,</span> <span class="n">local_PRoot_version</span><span class="p">),</span>
<a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a><span class="p">]</span>
<a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>
<a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a><span class="n">skipsteps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">]</span>
<a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a>
<a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a><span class="n">files_to_copy</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a>    <span class="p">([</span><span class="n">local_sif</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">),</span>
<a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a><span class="p">]</span>
<a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a>
<a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a>
<a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a><span class="c1">#</span>
<a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a><span class="c1"># Script Container definition for `singularity build`.</span>
<a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a><span class="c1">#</span>
<a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a><span class="n">local_container_def</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a><span class="s2">Bootstrap: localimage</span>
<a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a>
<a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a><span class="s2">From: </span><span class="si">{</span><span class="n">local_sif</span><span class="si">}</span>
<a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a>
<a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a><span class="s2">%environment</span>
<a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a>
<a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a><span class="s2">    export BASH_ENV=/opt/cray/pe/lmod/lmod/init/bash</span>
<a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a>
<a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a><span class="s2">%files</span>
<a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a>
<a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a><span class="s2">    %(installdir)s/config/99-z-init-ccpe.sh /.singularity.d/env</span>
<a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a><span class="s2">    %(installdir)s/config/profile.local     /etc</span>
<a id="__codelineno-1-130" name="__codelineno-1-130" href="#__codelineno-1-130"></a><span class="s2">    %(installdir)s/config/bash.bashrc.local /etc</span>
<a id="__codelineno-1-131" name="__codelineno-1-131" href="#__codelineno-1-131"></a><span class="s2">    %(installdir)s/config/runscript         /.singularity.d</span>
<a id="__codelineno-1-132" name="__codelineno-1-132" href="#__codelineno-1-132"></a>
<a id="__codelineno-1-133" name="__codelineno-1-133" href="#__codelineno-1-133"></a><span class="s2">    /opt/cray/pe/lmod/modulefiles/core/rocm/</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.lua /opt/cray/pe/lmod/modulefiles/core/rocm/</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-134" name="__codelineno-1-134" href="#__codelineno-1-134"></a><span class="s2">    /opt/cray/pe/lmod/modulefiles/core/amd/</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.lua  /opt/cray/pe/lmod/modulefiles/core/amd/</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-135" name="__codelineno-1-135" href="#__codelineno-1-135"></a><span class="s2">    /opt/cray/pe/lmod/modulefiles/core/rocm/</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.lua /opt/cray/pe/lmod/modulefiles/core/rocm/</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-136" name="__codelineno-1-136" href="#__codelineno-1-136"></a><span class="s2">    /opt/cray/pe/lmod/modulefiles/core/amd/</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.lua  /opt/cray/pe/lmod/modulefiles/core/amd/</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-137" name="__codelineno-1-137" href="#__codelineno-1-137"></a>
<a id="__codelineno-1-138" name="__codelineno-1-138" href="#__codelineno-1-138"></a><span class="s2">    /opt/cray/pe/lmod/modulefiles/mix_compilers/amd-mixed/</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.lua /opt/cray/pe/lmod/modulefiles/mix_compilers/amd-mixed/</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.lua </span>
<a id="__codelineno-1-139" name="__codelineno-1-139" href="#__codelineno-1-139"></a><span class="s2">    /opt/cray/pe/lmod/modulefiles/mix_compilers/amd-mixed/</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.lua /opt/cray/pe/lmod/modulefiles/mix_compilers/amd-mixed/</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.lua </span>
<a id="__codelineno-1-140" name="__codelineno-1-140" href="#__codelineno-1-140"></a>
<a id="__codelineno-1-141" name="__codelineno-1-141" href="#__codelineno-1-141"></a><span class="s2">    /opt/cray/pals/1.3.2                              /opt/cray/pals/1.3.2</span>
<a id="__codelineno-1-142" name="__codelineno-1-142" href="#__codelineno-1-142"></a><span class="s2">    /opt/cray/pals/lmod/modulefiles/core/cray-pals    /opt/cray/pe/lmod/modulefiles/core/cray-pals</span>
<a id="__codelineno-1-143" name="__codelineno-1-143" href="#__codelineno-1-143"></a><span class="s2">    /opt/cray/pals/lmod/modulefiles/core/cray-libpals /opt/cray/pe/lmod/modulefiles/core/cray-libpals</span>
<a id="__codelineno-1-144" name="__codelineno-1-144" href="#__codelineno-1-144"></a><span class="s2">    /opt/cray/pals/modulefiles/cray-pals              /opt/cray/pe/modulefiles/cray-pals</span>
<a id="__codelineno-1-145" name="__codelineno-1-145" href="#__codelineno-1-145"></a><span class="s2">    /opt/cray/pals/modulefiles/cray-libpals           /opt/cray/pe/modulefiles/cray-libpals</span>
<a id="__codelineno-1-146" name="__codelineno-1-146" href="#__codelineno-1-146"></a>
<a id="__codelineno-1-147" name="__codelineno-1-147" href="#__codelineno-1-147"></a><span class="s2">    # Get libjansson from the system as the version we download with OpenSUSE is an older version</span>
<a id="__codelineno-1-148" name="__codelineno-1-148" href="#__codelineno-1-148"></a><span class="s2">    # that gives issues with cray-pals</span>
<a id="__codelineno-1-149" name="__codelineno-1-149" href="#__codelineno-1-149"></a><span class="s2">    /usr/lib64/libjansson.so.4.14.0</span>
<a id="__codelineno-1-150" name="__codelineno-1-150" href="#__codelineno-1-150"></a>
<a id="__codelineno-1-151" name="__codelineno-1-151" href="#__codelineno-1-151"></a><span class="s2">    # Get Lustre libraries from the system</span>
<a id="__codelineno-1-152" name="__codelineno-1-152" href="#__codelineno-1-152"></a><span class="s2">    /usr/lib64/liblustreapi.so.1.0.0</span>
<a id="__codelineno-1-153" name="__codelineno-1-153" href="#__codelineno-1-153"></a><span class="s2">    /usr/lib64/liblnetconfig.so.4.0.0</span>
<a id="__codelineno-1-154" name="__codelineno-1-154" href="#__codelineno-1-154"></a>
<a id="__codelineno-1-155" name="__codelineno-1-155" href="#__codelineno-1-155"></a><span class="s2">    /etc/group</span>
<a id="__codelineno-1-156" name="__codelineno-1-156" href="#__codelineno-1-156"></a><span class="s2">    /etc/passwd</span>
<a id="__codelineno-1-157" name="__codelineno-1-157" href="#__codelineno-1-157"></a>
<a id="__codelineno-1-158" name="__codelineno-1-158" href="#__codelineno-1-158"></a><span class="s2">    /usr/lib64/pkgconfig/rocm-5.7.pc</span>
<a id="__codelineno-1-159" name="__codelineno-1-159" href="#__codelineno-1-159"></a><span class="s2">    /usr/lib64/pkgconfig/rocm-</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.pc /usr/lib64/pkgconfig/rocm-</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.pc</span>
<a id="__codelineno-1-160" name="__codelineno-1-160" href="#__codelineno-1-160"></a><span class="s2">    /usr/lib64/pkgconfig/rocm-</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">.pc /usr/lib64/pkgconfig/rocm-</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.pc</span>
<a id="__codelineno-1-161" name="__codelineno-1-161" href="#__codelineno-1-161"></a>
<a id="__codelineno-1-162" name="__codelineno-1-162" href="#__codelineno-1-162"></a><span class="s2">    # 2 files/directories that we will remove again but need for now for a successful build.</span>
<a id="__codelineno-1-163" name="__codelineno-1-163" href="#__codelineno-1-163"></a><span class="s2">    /opt/cray/xpmem</span>
<a id="__codelineno-1-164" name="__codelineno-1-164" href="#__codelineno-1-164"></a><span class="s2">    /etc/slurm/slurm.conf</span>
<a id="__codelineno-1-165" name="__codelineno-1-165" href="#__codelineno-1-165"></a>
<a id="__codelineno-1-166" name="__codelineno-1-166" href="#__codelineno-1-166"></a><span class="s2">%post</span>
<a id="__codelineno-1-167" name="__codelineno-1-167" href="#__codelineno-1-167"></a>
<a id="__codelineno-1-168" name="__codelineno-1-168" href="#__codelineno-1-168"></a><span class="s2">    # Install additional packages</span>
<a id="__codelineno-1-169" name="__codelineno-1-169" href="#__codelineno-1-169"></a><span class="s2">    zypper --non-interactive --no-gpg-checks addrepo https://download.opensuse.org/distribution/leap/15.5/repo/oss/ oss</span>
<a id="__codelineno-1-170" name="__codelineno-1-170" href="#__codelineno-1-170"></a>
<a id="__codelineno-1-171" name="__codelineno-1-171" href="#__codelineno-1-171"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage libopenssl-devel</span>
<a id="__codelineno-1-172" name="__codelineno-1-172" href="#__codelineno-1-172"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage libcurl-devel</span>
<a id="__codelineno-1-173" name="__codelineno-1-173" href="#__codelineno-1-173"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage curl</span>
<a id="__codelineno-1-174" name="__codelineno-1-174" href="#__codelineno-1-174"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage unzip</span>
<a id="__codelineno-1-175" name="__codelineno-1-175" href="#__codelineno-1-175"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage bzip2</span>
<a id="__codelineno-1-176" name="__codelineno-1-176" href="#__codelineno-1-176"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage glibc-devel-static</span>
<a id="__codelineno-1-177" name="__codelineno-1-177" href="#__codelineno-1-177"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage groff</span>
<a id="__codelineno-1-178" name="__codelineno-1-178" href="#__codelineno-1-178"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage rsync # Needed for ROCm installation...</span>
<a id="__codelineno-1-179" name="__codelineno-1-179" href="#__codelineno-1-179"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage vim</span>
<a id="__codelineno-1-180" name="__codelineno-1-180" href="#__codelineno-1-180"></a>
<a id="__codelineno-1-181" name="__codelineno-1-181" href="#__codelineno-1-181"></a><span class="s2">    # Support for Lustre also requires some SUSE packages but they may already be in the container</span>
<a id="__codelineno-1-182" name="__codelineno-1-182" href="#__codelineno-1-182"></a><span class="s2">    # In fact, we outcomment since in the current container they are present.</span>
<a id="__codelineno-1-183" name="__codelineno-1-183" href="#__codelineno-1-183"></a><span class="s2">    # zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage libnghttp2-14</span>
<a id="__codelineno-1-184" name="__codelineno-1-184" href="#__codelineno-1-184"></a><span class="s2">    # zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage libnl3-200</span>
<a id="__codelineno-1-185" name="__codelineno-1-185" href="#__codelineno-1-185"></a>
<a id="__codelineno-1-186" name="__codelineno-1-186" href="#__codelineno-1-186"></a><span class="s2">    # The container lacks locales except for C and POSIX which causes too many issues, including some</span>
<a id="__codelineno-1-187" name="__codelineno-1-187" href="#__codelineno-1-187"></a><span class="s2">    # Python packages for EasyBuild that do not even install or crash when running.    </span>
<a id="__codelineno-1-188" name="__codelineno-1-188" href="#__codelineno-1-188"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage glibc-locale</span>
<a id="__codelineno-1-189" name="__codelineno-1-189" href="#__codelineno-1-189"></a>
<a id="__codelineno-1-190" name="__codelineno-1-190" href="#__codelineno-1-190"></a><span class="s2">    # Install ROCm 6.2.4 as a backup version</span>
<a id="__codelineno-1-191" name="__codelineno-1-191" href="#__codelineno-1-191"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install https://repo.radeon.com/amdgpu-install/6.2.4/sle/15.5/amdgpu-install-6.2.60204-1.noarch.rpm</span>
<a id="__codelineno-1-192" name="__codelineno-1-192" href="#__codelineno-1-192"></a><span class="s2">    zypper --non-interactive --gpg-auto-import-keys refresh</span>
<a id="__codelineno-1-193" name="__codelineno-1-193" href="#__codelineno-1-193"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage amdgpu-dkms rocm6.2.4</span>
<a id="__codelineno-1-194" name="__codelineno-1-194" href="#__codelineno-1-194"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage rocm-llvm-devel6.2.4 rocm-cmake6.2.4</span>
<a id="__codelineno-1-195" name="__codelineno-1-195" href="#__codelineno-1-195"></a>
<a id="__codelineno-1-196" name="__codelineno-1-196" href="#__codelineno-1-196"></a><span class="s2">    # Install ROCm 6.3.4 as the main version</span>
<a id="__codelineno-1-197" name="__codelineno-1-197" href="#__codelineno-1-197"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install https://repo.radeon.com/amdgpu-install/6.3.4/sle/15.5/amdgpu-install-6.3.60304-1.noarch.rpm</span>
<a id="__codelineno-1-198" name="__codelineno-1-198" href="#__codelineno-1-198"></a><span class="s2">    zypper --non-interactive --gpg-auto-import-keys refresh</span>
<a id="__codelineno-1-199" name="__codelineno-1-199" href="#__codelineno-1-199"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage amdgpu-dkms rocm6.3.4</span>
<a id="__codelineno-1-200" name="__codelineno-1-200" href="#__codelineno-1-200"></a><span class="s2">    zypper --non-interactive --no-gpg-checks --no-refresh install --no-recommends --allow-downgrade --oldpackage rocm-llvm-devel6.3.4 rocm-cmake6.3.4</span>
<a id="__codelineno-1-201" name="__codelineno-1-201" href="#__codelineno-1-201"></a>
<a id="__codelineno-1-202" name="__codelineno-1-202" href="#__codelineno-1-202"></a><span class="s2">    # Tweak Lmod to use a different cache directory</span>
<a id="__codelineno-1-203" name="__codelineno-1-203" href="#__codelineno-1-203"></a><span class="s2">    sed -e &#39;s|.cache/lmod|.cache/lmod/ccpe-</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">|&#39; -i /opt/cray/pe/lmod/lmod/libexec/myGlobals.lua</span>
<a id="__codelineno-1-204" name="__codelineno-1-204" href="#__codelineno-1-204"></a>
<a id="__codelineno-1-205" name="__codelineno-1-205" href="#__codelineno-1-205"></a><span class="s2">    # Correct the broken default link for xpmem via /etc/alternatives and make sure</span>
<a id="__codelineno-1-206" name="__codelineno-1-206" href="#__codelineno-1-206"></a><span class="s2">    # the libraries are in the default search path</span>
<a id="__codelineno-1-207" name="__codelineno-1-207" href="#__codelineno-1-207"></a><span class="s2">    ln -s /opt/cray/xpmem/2.8.2-1.0_5.1__g84a27a5.shasta /etc/alternatives/cray-xpmem</span>
<a id="__codelineno-1-208" name="__codelineno-1-208" href="#__codelineno-1-208"></a><span class="s2">    echo &quot;/opt/cray/xpmem/default/lib64&quot; &gt;/etc/ld.so.conf.d/cray-xpmem.conf</span>
<a id="__codelineno-1-209" name="__codelineno-1-209" href="#__codelineno-1-209"></a><span class="s2">    chmod 644 /etc/ld.so.conf.d/cray-xpmem.conf</span>
<a id="__codelineno-1-210" name="__codelineno-1-210" href="#__codelineno-1-210"></a>
<a id="__codelineno-1-211" name="__codelineno-1-211" href="#__codelineno-1-211"></a><span class="s2">    # Put links for pals and put in the search path for shared libraries</span>
<a id="__codelineno-1-212" name="__codelineno-1-212" href="#__codelineno-1-212"></a><span class="s2">    ln -s /opt/cray/pals/1.3.2 /opt/cray/pals/default</span>
<a id="__codelineno-1-213" name="__codelineno-1-213" href="#__codelineno-1-213"></a><span class="s2">    echo &quot;/opt/cray/pals/default/lib&quot; &gt;/etc/ld.so.conf.d/cray-pals.conf</span>
<a id="__codelineno-1-214" name="__codelineno-1-214" href="#__codelineno-1-214"></a><span class="s2">    chmod 644 /etc/ld.so.conf.d/cray-pals.conf</span>
<a id="__codelineno-1-215" name="__codelineno-1-215" href="#__codelineno-1-215"></a>
<a id="__codelineno-1-216" name="__codelineno-1-216" href="#__codelineno-1-216"></a><span class="s2">    # Create the symbolic links for the Lustre libraries</span>
<a id="__codelineno-1-217" name="__codelineno-1-217" href="#__codelineno-1-217"></a><span class="s2">    #ln -s /usr/lib64/liblustreapi.so.1.0.0 /usr/lib64/liblustreapi.so.1   # Turns out this is done automatically????</span>
<a id="__codelineno-1-218" name="__codelineno-1-218" href="#__codelineno-1-218"></a><span class="s2">    ln -s /usr/lib64/liblustreapi.so.1.0.0 /usr/lib64/liblustreapi.so</span>
<a id="__codelineno-1-219" name="__codelineno-1-219" href="#__codelineno-1-219"></a><span class="s2">    #ln -s /usr/lib64/liblnetconfig.so.4.0.0 /usr/lib64/liblnetconfig.so.4 # Turns out this is done automatically????</span>
<a id="__codelineno-1-220" name="__codelineno-1-220" href="#__codelineno-1-220"></a>
<a id="__codelineno-1-221" name="__codelineno-1-221" href="#__codelineno-1-221"></a><span class="s2">    # Tweak the ROCm and AMD modules</span>
<a id="__codelineno-1-222" name="__codelineno-1-222" href="#__codelineno-1-222"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /opt/cray/pe/lmod/modulefiles/core/rocm/</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-223" name="__codelineno-1-223" href="#__codelineno-1-223"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /opt/cray/pe/lmod/modulefiles/core/amd/</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-224" name="__codelineno-1-224" href="#__codelineno-1-224"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /opt/cray/pe/lmod/modulefiles/core/rocm/</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-225" name="__codelineno-1-225" href="#__codelineno-1-225"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /opt/cray/pe/lmod/modulefiles/core/amd/</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-226" name="__codelineno-1-226" href="#__codelineno-1-226"></a>
<a id="__codelineno-1-227" name="__codelineno-1-227" href="#__codelineno-1-227"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /opt/cray/pe/lmod/modulefiles/mix_compilers/amd-mixed/</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.lua</span>
<a id="__codelineno-1-228" name="__codelineno-1-228" href="#__codelineno-1-228"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /opt/cray/pe/lmod/modulefiles/mix_compilers/amd-mixed/</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.lua </span>
<a id="__codelineno-1-229" name="__codelineno-1-229" href="#__codelineno-1-229"></a>
<a id="__codelineno-1-230" name="__codelineno-1-230" href="#__codelineno-1-230"></a><span class="s2">    # Tweak the pkgconfig files for ROCm</span>
<a id="__codelineno-1-231" name="__codelineno-1-231" href="#__codelineno-1-231"></a><span class="s2">    ln -s /usr/lib64/pkgconfig/rocm-5.7.pc /usr/lib64/pkgconfig/rocm.pc</span>
<a id="__codelineno-1-232" name="__codelineno-1-232" href="#__codelineno-1-232"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /usr/lib64/pkgconfig/rocm-</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2">.pc</span>
<a id="__codelineno-1-233" name="__codelineno-1-233" href="#__codelineno-1-233"></a><span class="s2">    sed -e &#39;s|</span><span class="si">{</span><span class="n">local_rocm_version</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">|g&#39; -i /usr/lib64/pkgconfig/rocm-</span><span class="si">{</span><span class="n">local_c2_rocm_version</span><span class="si">}</span><span class="s2">.pc</span>
<a id="__codelineno-1-234" name="__codelineno-1-234" href="#__codelineno-1-234"></a>
<a id="__codelineno-1-235" name="__codelineno-1-235" href="#__codelineno-1-235"></a><span class="s2">    # Create the /opt/rocm symbolic link</span>
<a id="__codelineno-1-236" name="__codelineno-1-236" href="#__codelineno-1-236"></a><span class="s2">    mkdir -p /opt/rocm-</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span>
<a id="__codelineno-1-237" name="__codelineno-1-237" href="#__codelineno-1-237"></a><span class="s2">    ln -s /opt/rocm-</span><span class="si">{</span><span class="n">local_c1_rocm_version</span><span class="si">}</span><span class="s2"> /etc/alternatives/rocm</span>
<a id="__codelineno-1-238" name="__codelineno-1-238" href="#__codelineno-1-238"></a><span class="s2">    ln -s /etc/alternatives/rocm /opt/rocm</span>
<a id="__codelineno-1-239" name="__codelineno-1-239" href="#__codelineno-1-239"></a>
<a id="__codelineno-1-240" name="__codelineno-1-240" href="#__codelineno-1-240"></a><span class="s2">    # Rebuild the cache for ld.so as we have added several conf files in /etc/ld.so.conf.d.</span>
<a id="__codelineno-1-241" name="__codelineno-1-241" href="#__codelineno-1-241"></a><span class="s2">    /sbin/ldconfig</span>
<a id="__codelineno-1-242" name="__codelineno-1-242" href="#__codelineno-1-242"></a>
<a id="__codelineno-1-243" name="__codelineno-1-243" href="#__codelineno-1-243"></a><span class="s2">    # No longer needed, we prefer to bind the system one to always be up-to-date.</span>
<a id="__codelineno-1-244" name="__codelineno-1-244" href="#__codelineno-1-244"></a><span class="s2">    /bin/rm -rf /etc/slurm</span>
<a id="__codelineno-1-245" name="__codelineno-1-245" href="#__codelineno-1-245"></a>
<a id="__codelineno-1-246" name="__codelineno-1-246" href="#__codelineno-1-246"></a><span class="s2">    # No longer needed, we&#39;ll bind that one when running to be sure to always have the system version.</span>
<a id="__codelineno-1-247" name="__codelineno-1-247" href="#__codelineno-1-247"></a><span class="s2">    /bin/rm -rf /opt/cray/xpmem</span>
<a id="__codelineno-1-248" name="__codelineno-1-248" href="#__codelineno-1-248"></a>
<a id="__codelineno-1-249" name="__codelineno-1-249" href="#__codelineno-1-249"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-250" name="__codelineno-1-250" href="#__codelineno-1-250"></a>
<a id="__codelineno-1-251" name="__codelineno-1-251" href="#__codelineno-1-251"></a>
<a id="__codelineno-1-252" name="__codelineno-1-252" href="#__codelineno-1-252"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-253" name="__codelineno-1-253" href="#__codelineno-1-253"></a><span class="c1">#</span>
<a id="__codelineno-1-254" name="__codelineno-1-254" href="#__codelineno-1-254"></a><span class="c1"># Runscript for the container</span>
<a id="__codelineno-1-255" name="__codelineno-1-255" href="#__codelineno-1-255"></a><span class="c1">#</span>
<a id="__codelineno-1-256" name="__codelineno-1-256" href="#__codelineno-1-256"></a><span class="n">local_runscript</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-257" name="__codelineno-1-257" href="#__codelineno-1-257"></a><span class="s2">#!/bin/bash</span>
<a id="__codelineno-1-258" name="__codelineno-1-258" href="#__codelineno-1-258"></a><span class="s2">#</span>
<a id="__codelineno-1-259" name="__codelineno-1-259" href="#__codelineno-1-259"></a><span class="s2"># This is the most basic runscript possible: &quot;singularity run&quot; for this</span>
<a id="__codelineno-1-260" name="__codelineno-1-260" href="#__codelineno-1-260"></a><span class="s2"># container, starts &quot;bash&quot; and as the &quot;singularity run&quot; prescribes,</span>
<a id="__codelineno-1-261" name="__codelineno-1-261" href="#__codelineno-1-261"></a><span class="s2"># all arguments are simply passed to bash.</span>
<a id="__codelineno-1-262" name="__codelineno-1-262" href="#__codelineno-1-262"></a><span class="s2">#</span>
<a id="__codelineno-1-263" name="__codelineno-1-263" href="#__codelineno-1-263"></a><span class="s2">/usr/bin/bash &quot;$@&quot;</span>
<a id="__codelineno-1-264" name="__codelineno-1-264" href="#__codelineno-1-264"></a>
<a id="__codelineno-1-265" name="__codelineno-1-265" href="#__codelineno-1-265"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-266" name="__codelineno-1-266" href="#__codelineno-1-266"></a>
<a id="__codelineno-1-267" name="__codelineno-1-267" href="#__codelineno-1-267"></a>
<a id="__codelineno-1-268" name="__codelineno-1-268" href="#__codelineno-1-268"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-269" name="__codelineno-1-269" href="#__codelineno-1-269"></a><span class="c1">#</span>
<a id="__codelineno-1-270" name="__codelineno-1-270" href="#__codelineno-1-270"></a><span class="c1"># Script 99-z-init-ccpe.sh</span>
<a id="__codelineno-1-271" name="__codelineno-1-271" href="#__codelineno-1-271"></a><span class="c1">#</span>
<a id="__codelineno-1-272" name="__codelineno-1-272" href="#__codelineno-1-272"></a><span class="c1"># Initialisation script for /etc/profile.d</span>
<a id="__codelineno-1-273" name="__codelineno-1-273" href="#__codelineno-1-273"></a><span class="c1">#</span>
<a id="__codelineno-1-274" name="__codelineno-1-274" href="#__codelineno-1-274"></a><span class="n">local_99_z_ccpe_init</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-275" name="__codelineno-1-275" href="#__codelineno-1-275"></a><span class="s2">export INITCCPE=&#39;</span>
<a id="__codelineno-1-276" name="__codelineno-1-276" href="#__codelineno-1-276"></a><span class="s2">if [ &quot;$CCPE_VERSION&quot; != &quot;</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">&quot; ] ;</span>
<a id="__codelineno-1-277" name="__codelineno-1-277" href="#__codelineno-1-277"></a><span class="s2">then</span>
<a id="__codelineno-1-278" name="__codelineno-1-278" href="#__codelineno-1-278"></a>
<a id="__codelineno-1-279" name="__codelineno-1-279" href="#__codelineno-1-279"></a><span class="s2">    lmod_dir=&quot;/opt/cray/pe/lmod/lmod&quot; ;</span>
<a id="__codelineno-1-280" name="__codelineno-1-280" href="#__codelineno-1-280"></a>
<a id="__codelineno-1-281" name="__codelineno-1-281" href="#__codelineno-1-281"></a><span class="s2">    source /etc/cray-pe.d/cray-pe-configuration.sh ;</span>
<a id="__codelineno-1-282" name="__codelineno-1-282" href="#__codelineno-1-282"></a>
<a id="__codelineno-1-283" name="__codelineno-1-283" href="#__codelineno-1-283"></a><span class="s2">    source $lmod_dir/init/profile ;</span>
<a id="__codelineno-1-284" name="__codelineno-1-284" href="#__codelineno-1-284"></a>
<a id="__codelineno-1-285" name="__codelineno-1-285" href="#__codelineno-1-285"></a><span class="s2">    mod_paths=&quot;/opt/cray/pe/lmod/modulefiles/core /opt/cray/pe/lmod/modulefiles/craype-targets/default $mpaths /opt/cray/modulefiles /opt/modulefiles&quot; ;</span>
<a id="__codelineno-1-286" name="__codelineno-1-286" href="#__codelineno-1-286"></a><span class="s2">    MODULEPATH=&quot;&quot; ;</span>
<a id="__codelineno-1-287" name="__codelineno-1-287" href="#__codelineno-1-287"></a><span class="s2">    for p in $(echo $mod_paths) ;</span>
<a id="__codelineno-1-288" name="__codelineno-1-288" href="#__codelineno-1-288"></a><span class="s2">    do </span>
<a id="__codelineno-1-289" name="__codelineno-1-289" href="#__codelineno-1-289"></a><span class="s2">        if [ -d $p ] ; </span>
<a id="__codelineno-1-290" name="__codelineno-1-290" href="#__codelineno-1-290"></a><span class="s2">        then</span>
<a id="__codelineno-1-291" name="__codelineno-1-291" href="#__codelineno-1-291"></a><span class="s2">            MODULEPATH=$MODULEPATH:$p ;</span>
<a id="__codelineno-1-292" name="__codelineno-1-292" href="#__codelineno-1-292"></a><span class="s2">        fi ;</span>
<a id="__codelineno-1-293" name="__codelineno-1-293" href="#__codelineno-1-293"></a><span class="s2">    done ;</span>
<a id="__codelineno-1-294" name="__codelineno-1-294" href="#__codelineno-1-294"></a><span class="s2">    export MODULEPATH=$</span><span class="se">{{</span><span class="s2">MODULEPATH/:/</span><span class="se">}}</span><span class="s2"> ;</span>
<a id="__codelineno-1-295" name="__codelineno-1-295" href="#__codelineno-1-295"></a>
<a id="__codelineno-1-296" name="__codelineno-1-296" href="#__codelineno-1-296"></a><span class="s2">    LMOD_SYSTEM_DEFAULT_MODULES=$(echo $</span><span class="se">{{</span><span class="s2">init_module_list:-PrgEnv-$default_prgenv</span><span class="se">}}</span><span class="s2"> | sed -E &quot;s_[[:space:]]+_:_g&quot;) ;</span>
<a id="__codelineno-1-297" name="__codelineno-1-297" href="#__codelineno-1-297"></a><span class="s2">    export LMOD_SYSTEM_DEFAULT_MODULES ;</span>
<a id="__codelineno-1-298" name="__codelineno-1-298" href="#__codelineno-1-298"></a><span class="s2">    eval &quot;source $BASH_ENV &amp;&amp; module --initial_load --no_redirect restore&quot; ;</span>
<a id="__codelineno-1-299" name="__codelineno-1-299" href="#__codelineno-1-299"></a><span class="s2">    unset lmod_dir ;</span>
<a id="__codelineno-1-300" name="__codelineno-1-300" href="#__codelineno-1-300"></a>
<a id="__codelineno-1-301" name="__codelineno-1-301" href="#__codelineno-1-301"></a><span class="s2">    export CCPE_VERSION=&quot;</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">&quot; ;</span>
<a id="__codelineno-1-302" name="__codelineno-1-302" href="#__codelineno-1-302"></a>
<a id="__codelineno-1-303" name="__codelineno-1-303" href="#__codelineno-1-303"></a><span class="s2">fi ;</span>
<a id="__codelineno-1-304" name="__codelineno-1-304" href="#__codelineno-1-304"></a><span class="s2">if [[ $</span><span class="se">{{</span><span class="s2">-/*i*/i</span><span class="se">}}</span><span class="s2"> == i ]] ;</span>
<a id="__codelineno-1-305" name="__codelineno-1-305" href="#__codelineno-1-305"></a><span class="s2">then</span>
<a id="__codelineno-1-306" name="__codelineno-1-306" href="#__codelineno-1-306"></a><span class="s2">    if [ -z &quot;$SLURM_PROCID&quot; -o &quot;$SLURM_PROCID&quot; = &quot;0&quot; ]; </span>
<a id="__codelineno-1-307" name="__codelineno-1-307" href="#__codelineno-1-307"></a><span class="s2">    then</span>
<a id="__codelineno-1-308" name="__codelineno-1-308" href="#__codelineno-1-308"></a><span class="s2">        printf &quot;</span><span class="se">\\</span><span class="s2">nWelcome to the CPE container.</span><span class="se">\\</span><span class="s2">n&quot; ;</span>
<a id="__codelineno-1-309" name="__codelineno-1-309" href="#__codelineno-1-309"></a><span class="s2">        printf &quot;By using it you agree to the license https://downloads.hpe.com/pub/softlib2/software1/doc/p1796552785/v113125/eula-en.html</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n&quot; ;</span>
<a id="__codelineno-1-310" name="__codelineno-1-310" href="#__codelineno-1-310"></a><span class="s2">    fi ;</span>
<a id="__codelineno-1-311" name="__codelineno-1-311" href="#__codelineno-1-311"></a><span class="s2">fi ;</span>
<a id="__codelineno-1-312" name="__codelineno-1-312" href="#__codelineno-1-312"></a><span class="s2">function clear-lmod() </span><span class="se">{{</span><span class="s2"> [ -d $HOME/.cache/lmod ] &amp;&amp; /bin/rm -rf $HOME/.cache/lmod ; </span><span class="se">}}</span><span class="s2"> ;</span>
<a id="__codelineno-1-313" name="__codelineno-1-313" href="#__codelineno-1-313"></a><span class="s2">function ccpe-srun() </span><span class="se">{{</span><span class="s2"> SINGULARITYENV_PATH=$PATH SINGULARITYENV_LD_LIBRARY_PATH=$LD_LIBRARY_PATH srun &quot;$@&quot; ; </span><span class="se">}}</span><span class="s2"> ;</span>
<a id="__codelineno-1-314" name="__codelineno-1-314" href="#__codelineno-1-314"></a><span class="s2">&#39;</span>
<a id="__codelineno-1-315" name="__codelineno-1-315" href="#__codelineno-1-315"></a>
<a id="__codelineno-1-316" name="__codelineno-1-316" href="#__codelineno-1-316"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-317" name="__codelineno-1-317" href="#__codelineno-1-317"></a>
<a id="__codelineno-1-318" name="__codelineno-1-318" href="#__codelineno-1-318"></a>
<a id="__codelineno-1-319" name="__codelineno-1-319" href="#__codelineno-1-319"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-320" name="__codelineno-1-320" href="#__codelineno-1-320"></a><span class="c1">#</span>
<a id="__codelineno-1-321" name="__codelineno-1-321" href="#__codelineno-1-321"></a><span class="c1"># Custom script /etc/bash.bashrc.local</span>
<a id="__codelineno-1-322" name="__codelineno-1-322" href="#__codelineno-1-322"></a><span class="c1">#</span>
<a id="__codelineno-1-323" name="__codelineno-1-323" href="#__codelineno-1-323"></a><span class="n">local_bashrc_local</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-324" name="__codelineno-1-324" href="#__codelineno-1-324"></a><span class="s2">#! /bin/sh</span>
<a id="__codelineno-1-325" name="__codelineno-1-325" href="#__codelineno-1-325"></a>
<a id="__codelineno-1-326" name="__codelineno-1-326" href="#__codelineno-1-326"></a><span class="s2">eval $INITCCPE</span>
<a id="__codelineno-1-327" name="__codelineno-1-327" href="#__codelineno-1-327"></a>
<a id="__codelineno-1-328" name="__codelineno-1-328" href="#__codelineno-1-328"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-329" name="__codelineno-1-329" href="#__codelineno-1-329"></a>
<a id="__codelineno-1-330" name="__codelineno-1-330" href="#__codelineno-1-330"></a>
<a id="__codelineno-1-331" name="__codelineno-1-331" href="#__codelineno-1-331"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-332" name="__codelineno-1-332" href="#__codelineno-1-332"></a><span class="c1">#</span>
<a id="__codelineno-1-333" name="__codelineno-1-333" href="#__codelineno-1-333"></a><span class="c1"># Custom script /etc/profile.local</span>
<a id="__codelineno-1-334" name="__codelineno-1-334" href="#__codelineno-1-334"></a><span class="c1">#</span>
<a id="__codelineno-1-335" name="__codelineno-1-335" href="#__codelineno-1-335"></a><span class="c1">#</span>
<a id="__codelineno-1-336" name="__codelineno-1-336" href="#__codelineno-1-336"></a><span class="n">local_profile_local</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-337" name="__codelineno-1-337" href="#__codelineno-1-337"></a>
<a id="__codelineno-1-338" name="__codelineno-1-338" href="#__codelineno-1-338"></a><span class="s2"># Currently empty</span>
<a id="__codelineno-1-339" name="__codelineno-1-339" href="#__codelineno-1-339"></a>
<a id="__codelineno-1-340" name="__codelineno-1-340" href="#__codelineno-1-340"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-341" name="__codelineno-1-341" href="#__codelineno-1-341"></a>
<a id="__codelineno-1-342" name="__codelineno-1-342" href="#__codelineno-1-342"></a>
<a id="__codelineno-1-343" name="__codelineno-1-343" href="#__codelineno-1-343"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-344" name="__codelineno-1-344" href="#__codelineno-1-344"></a><span class="c1">#</span>
<a id="__codelineno-1-345" name="__codelineno-1-345" href="#__codelineno-1-345"></a><span class="c1"># Script clearLmod-save</span>
<a id="__codelineno-1-346" name="__codelineno-1-346" href="#__codelineno-1-346"></a><span class="c1">#</span>
<a id="__codelineno-1-347" name="__codelineno-1-347" href="#__codelineno-1-347"></a><span class="c1"># A script that defines a function that can be used to clear Lmod while saving</span>
<a id="__codelineno-1-348" name="__codelineno-1-348" href="#__codelineno-1-348"></a><span class="c1"># some environment variables that were set by Lmod.</span>
<a id="__codelineno-1-349" name="__codelineno-1-349" href="#__codelineno-1-349"></a><span class="c1">#</span>
<a id="__codelineno-1-350" name="__codelineno-1-350" href="#__codelineno-1-350"></a><span class="n">local_clearLmod_save</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-351" name="__codelineno-1-351" href="#__codelineno-1-351"></a><span class="s2">#!/bin/bash</span>
<a id="__codelineno-1-352" name="__codelineno-1-352" href="#__codelineno-1-352"></a>
<a id="__codelineno-1-353" name="__codelineno-1-353" href="#__codelineno-1-353"></a><span class="s2">function clearLmod-save {</span>
<a id="__codelineno-1-354" name="__codelineno-1-354" href="#__codelineno-1-354"></a><span class="s2">    # The arguments are the variables set by Lmod that should be restored.</span>
<a id="__codelineno-1-355" name="__codelineno-1-355" href="#__codelineno-1-355"></a>
<a id="__codelineno-1-356" name="__codelineno-1-356" href="#__codelineno-1-356"></a><span class="s2">    # Save the variables that should be restored</span>
<a id="__codelineno-1-357" name="__codelineno-1-357" href="#__codelineno-1-357"></a><span class="s2">    for var in &quot;$@&quot;</span>
<a id="__codelineno-1-358" name="__codelineno-1-358" href="#__codelineno-1-358"></a><span class="s2">    do</span>
<a id="__codelineno-1-359" name="__codelineno-1-359" href="#__codelineno-1-359"></a><span class="s2">        if [ -v $var ] # Only try to copy if the variable really exists.</span>
<a id="__codelineno-1-360" name="__codelineno-1-360" href="#__codelineno-1-360"></a><span class="s2">        then</span>
<a id="__codelineno-1-361" name="__codelineno-1-361" href="#__codelineno-1-361"></a><span class="s2">            # eval save_$var=&quot;&#39;${!var}&#39;&quot;</span>
<a id="__codelineno-1-362" name="__codelineno-1-362" href="#__codelineno-1-362"></a><span class="s2">            # The next is a trick found via ChatGPT which is safer then the </span>
<a id="__codelineno-1-363" name="__codelineno-1-363" href="#__codelineno-1-363"></a><span class="s2">            # previous line when the commands are put in a variable, but one</span>
<a id="__codelineno-1-364" name="__codelineno-1-364" href="#__codelineno-1-364"></a><span class="s2">            # has to be careful in a bash function as it makes the variable</span>
<a id="__codelineno-1-365" name="__codelineno-1-365" href="#__codelineno-1-365"></a><span class="s2">            # a local one. So when restoring we need some additiona magic.</span>
<a id="__codelineno-1-366" name="__codelineno-1-366" href="#__codelineno-1-366"></a><span class="s2">            eval $(declare -p $var | sed -e &quot;s/$var/save_$var/&quot;)</span>
<a id="__codelineno-1-367" name="__codelineno-1-367" href="#__codelineno-1-367"></a><span class="s2">        fi</span>
<a id="__codelineno-1-368" name="__codelineno-1-368" href="#__codelineno-1-368"></a><span class="s2">    done</span>
<a id="__codelineno-1-369" name="__codelineno-1-369" href="#__codelineno-1-369"></a>
<a id="__codelineno-1-370" name="__codelineno-1-370" href="#__codelineno-1-370"></a><span class="s2">    # Now clean up</span>
<a id="__codelineno-1-371" name="__codelineno-1-371" href="#__codelineno-1-371"></a><span class="s2">    module --force purge</span>
<a id="__codelineno-1-372" name="__codelineno-1-372" href="#__codelineno-1-372"></a><span class="s2">    eval $($LMOD_DIR/clearLMOD_cmd --shell bash --full --quiet)</span>
<a id="__codelineno-1-373" name="__codelineno-1-373" href="#__codelineno-1-373"></a><span class="s2">    unset LUMI_INIT_FIRST_LOAD</span>
<a id="__codelineno-1-374" name="__codelineno-1-374" href="#__codelineno-1-374"></a><span class="s2">    ## Make sure that /etc/profile does not quit immediately when called.</span>
<a id="__codelineno-1-375" name="__codelineno-1-375" href="#__codelineno-1-375"></a><span class="s2">    unset PROFILEREAD</span>
<a id="__codelineno-1-376" name="__codelineno-1-376" href="#__codelineno-1-376"></a>
<a id="__codelineno-1-377" name="__codelineno-1-377" href="#__codelineno-1-377"></a><span class="s2">    # Restore the variables</span>
<a id="__codelineno-1-378" name="__codelineno-1-378" href="#__codelineno-1-378"></a><span class="s2">    for var in &quot;$@&quot;</span>
<a id="__codelineno-1-379" name="__codelineno-1-379" href="#__codelineno-1-379"></a><span class="s2">    do</span>
<a id="__codelineno-1-380" name="__codelineno-1-380" href="#__codelineno-1-380"></a><span class="s2">        varname=&quot;save_$var&quot;</span>
<a id="__codelineno-1-381" name="__codelineno-1-381" href="#__codelineno-1-381"></a><span class="s2">        if [ -v $varname ]</span>
<a id="__codelineno-1-382" name="__codelineno-1-382" href="#__codelineno-1-382"></a><span class="s2">        then</span>
<a id="__codelineno-1-383" name="__codelineno-1-383" href="#__codelineno-1-383"></a><span class="s2">            # eval export $var=&quot;&#39;${!varname}&#39;&quot;</span>
<a id="__codelineno-1-384" name="__codelineno-1-384" href="#__codelineno-1-384"></a><span class="s2">            # Some magic needed: Declare the variable as global and export, so -gx.</span>
<a id="__codelineno-1-385" name="__codelineno-1-385" href="#__codelineno-1-385"></a><span class="s2">            eval $(declare -p $varname | sed -e &quot;s/save_$var/$var/&quot; -e &quot;s/declare -x/declare -g/&quot;)</span>
<a id="__codelineno-1-386" name="__codelineno-1-386" href="#__codelineno-1-386"></a><span class="s2">            export $var</span>
<a id="__codelineno-1-387" name="__codelineno-1-387" href="#__codelineno-1-387"></a><span class="s2">        fi</span>
<a id="__codelineno-1-388" name="__codelineno-1-388" href="#__codelineno-1-388"></a><span class="s2">    done</span>
<a id="__codelineno-1-389" name="__codelineno-1-389" href="#__codelineno-1-389"></a>
<a id="__codelineno-1-390" name="__codelineno-1-390" href="#__codelineno-1-390"></a><span class="s2">}</span>
<a id="__codelineno-1-391" name="__codelineno-1-391" href="#__codelineno-1-391"></a>
<a id="__codelineno-1-392" name="__codelineno-1-392" href="#__codelineno-1-392"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-393" name="__codelineno-1-393" href="#__codelineno-1-393"></a>
<a id="__codelineno-1-394" name="__codelineno-1-394" href="#__codelineno-1-394"></a>
<a id="__codelineno-1-395" name="__codelineno-1-395" href="#__codelineno-1-395"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-396" name="__codelineno-1-396" href="#__codelineno-1-396"></a><span class="c1">#</span>
<a id="__codelineno-1-397" name="__codelineno-1-397" href="#__codelineno-1-397"></a><span class="c1"># Script ccpe-shell</span>
<a id="__codelineno-1-398" name="__codelineno-1-398" href="#__codelineno-1-398"></a><span class="c1">#</span>
<a id="__codelineno-1-399" name="__codelineno-1-399" href="#__codelineno-1-399"></a><span class="c1"># Start a shell in the container with proper initialisation.</span>
<a id="__codelineno-1-400" name="__codelineno-1-400" href="#__codelineno-1-400"></a><span class="c1">#</span>
<a id="__codelineno-1-401" name="__codelineno-1-401" href="#__codelineno-1-401"></a><span class="n">local_ccpe_shell</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-402" name="__codelineno-1-402" href="#__codelineno-1-402"></a><span class="s2">#!/bin/bash</span>
<a id="__codelineno-1-403" name="__codelineno-1-403" href="#__codelineno-1-403"></a>
<a id="__codelineno-1-404" name="__codelineno-1-404" href="#__codelineno-1-404"></a><span class="s2">source %(installdir)s/config/clearLmod-save</span>
<a id="__codelineno-1-405" name="__codelineno-1-405" href="#__codelineno-1-405"></a>
<a id="__codelineno-1-406" name="__codelineno-1-406" href="#__codelineno-1-406"></a><span class="s2">if [ &quot;$CCPE_VERSION&quot; != &quot;</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">&quot; ]</span>
<a id="__codelineno-1-407" name="__codelineno-1-407" href="#__codelineno-1-407"></a><span class="s2">then</span>
<a id="__codelineno-1-408" name="__codelineno-1-408" href="#__codelineno-1-408"></a><span class="s2">    clearLmod-save $</span><span class="se">{{</span><span class="s2">EXPORTCCPE//,/ </span><span class="se">}}</span>
<a id="__codelineno-1-409" name="__codelineno-1-409" href="#__codelineno-1-409"></a><span class="s2">fi</span>
<a id="__codelineno-1-410" name="__codelineno-1-410" href="#__codelineno-1-410"></a>
<a id="__codelineno-1-411" name="__codelineno-1-411" href="#__codelineno-1-411"></a><span class="s2">singularity shell &quot;$SIFCCPE&quot; &quot;$@&quot;</span>
<a id="__codelineno-1-412" name="__codelineno-1-412" href="#__codelineno-1-412"></a>
<a id="__codelineno-1-413" name="__codelineno-1-413" href="#__codelineno-1-413"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-414" name="__codelineno-1-414" href="#__codelineno-1-414"></a>
<a id="__codelineno-1-415" name="__codelineno-1-415" href="#__codelineno-1-415"></a>
<a id="__codelineno-1-416" name="__codelineno-1-416" href="#__codelineno-1-416"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-417" name="__codelineno-1-417" href="#__codelineno-1-417"></a><span class="c1">#</span>
<a id="__codelineno-1-418" name="__codelineno-1-418" href="#__codelineno-1-418"></a><span class="c1"># Script ccpe-exec</span>
<a id="__codelineno-1-419" name="__codelineno-1-419" href="#__codelineno-1-419"></a><span class="c1">#</span>
<a id="__codelineno-1-420" name="__codelineno-1-420" href="#__codelineno-1-420"></a><span class="c1"># Execute in the container with proper initialisation.</span>
<a id="__codelineno-1-421" name="__codelineno-1-421" href="#__codelineno-1-421"></a><span class="c1">#</span>
<a id="__codelineno-1-422" name="__codelineno-1-422" href="#__codelineno-1-422"></a><span class="n">local_ccpe_exec</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-423" name="__codelineno-1-423" href="#__codelineno-1-423"></a><span class="s2">#!/bin/bash</span>
<a id="__codelineno-1-424" name="__codelineno-1-424" href="#__codelineno-1-424"></a>
<a id="__codelineno-1-425" name="__codelineno-1-425" href="#__codelineno-1-425"></a><span class="s2">source %(installdir)s/config/clearLmod-save</span>
<a id="__codelineno-1-426" name="__codelineno-1-426" href="#__codelineno-1-426"></a>
<a id="__codelineno-1-427" name="__codelineno-1-427" href="#__codelineno-1-427"></a><span class="s2">if [ &quot;$CCPE_VERSION&quot; != &quot;</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">&quot; ]</span>
<a id="__codelineno-1-428" name="__codelineno-1-428" href="#__codelineno-1-428"></a><span class="s2">then</span>
<a id="__codelineno-1-429" name="__codelineno-1-429" href="#__codelineno-1-429"></a><span class="s2">    clearLmod-save $</span><span class="se">{{</span><span class="s2">EXPORTCCPE//,/ </span><span class="se">}}</span>
<a id="__codelineno-1-430" name="__codelineno-1-430" href="#__codelineno-1-430"></a><span class="s2">fi</span>
<a id="__codelineno-1-431" name="__codelineno-1-431" href="#__codelineno-1-431"></a>
<a id="__codelineno-1-432" name="__codelineno-1-432" href="#__codelineno-1-432"></a><span class="s2">singularity exec &quot;$SIFCCPE&quot; &quot;$@&quot;</span>
<a id="__codelineno-1-433" name="__codelineno-1-433" href="#__codelineno-1-433"></a>
<a id="__codelineno-1-434" name="__codelineno-1-434" href="#__codelineno-1-434"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-435" name="__codelineno-1-435" href="#__codelineno-1-435"></a>
<a id="__codelineno-1-436" name="__codelineno-1-436" href="#__codelineno-1-436"></a>
<a id="__codelineno-1-437" name="__codelineno-1-437" href="#__codelineno-1-437"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-438" name="__codelineno-1-438" href="#__codelineno-1-438"></a><span class="c1">#</span>
<a id="__codelineno-1-439" name="__codelineno-1-439" href="#__codelineno-1-439"></a><span class="c1"># Script ccpe-run</span>
<a id="__codelineno-1-440" name="__codelineno-1-440" href="#__codelineno-1-440"></a><span class="c1">#</span>
<a id="__codelineno-1-441" name="__codelineno-1-441" href="#__codelineno-1-441"></a><span class="c1"># Run the container with proper initialisation.</span>
<a id="__codelineno-1-442" name="__codelineno-1-442" href="#__codelineno-1-442"></a><span class="c1">#</span>
<a id="__codelineno-1-443" name="__codelineno-1-443" href="#__codelineno-1-443"></a><span class="n">local_ccpe_run</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-444" name="__codelineno-1-444" href="#__codelineno-1-444"></a><span class="s2">#!/bin/bash</span>
<a id="__codelineno-1-445" name="__codelineno-1-445" href="#__codelineno-1-445"></a>
<a id="__codelineno-1-446" name="__codelineno-1-446" href="#__codelineno-1-446"></a><span class="s2">source %(installdir)s/config/clearLmod-save</span>
<a id="__codelineno-1-447" name="__codelineno-1-447" href="#__codelineno-1-447"></a>
<a id="__codelineno-1-448" name="__codelineno-1-448" href="#__codelineno-1-448"></a><span class="s2">if [ &quot;$CCPE_VERSION&quot; != &quot;</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">&quot; ]</span>
<a id="__codelineno-1-449" name="__codelineno-1-449" href="#__codelineno-1-449"></a><span class="s2">then</span>
<a id="__codelineno-1-450" name="__codelineno-1-450" href="#__codelineno-1-450"></a><span class="s2">    clearLmod-save $</span><span class="se">{{</span><span class="s2">EXPORTCCPE//,/ </span><span class="se">}}</span>
<a id="__codelineno-1-451" name="__codelineno-1-451" href="#__codelineno-1-451"></a><span class="s2">fi</span>
<a id="__codelineno-1-452" name="__codelineno-1-452" href="#__codelineno-1-452"></a>
<a id="__codelineno-1-453" name="__codelineno-1-453" href="#__codelineno-1-453"></a><span class="s2">singularity run &quot;$SIFCCPE&quot; &quot;$@&quot;</span>
<a id="__codelineno-1-454" name="__codelineno-1-454" href="#__codelineno-1-454"></a>
<a id="__codelineno-1-455" name="__codelineno-1-455" href="#__codelineno-1-455"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-456" name="__codelineno-1-456" href="#__codelineno-1-456"></a>
<a id="__codelineno-1-457" name="__codelineno-1-457" href="#__codelineno-1-457"></a>
<a id="__codelineno-1-458" name="__codelineno-1-458" href="#__codelineno-1-458"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-459" name="__codelineno-1-459" href="#__codelineno-1-459"></a><span class="c1">#</span>
<a id="__codelineno-1-460" name="__codelineno-1-460" href="#__codelineno-1-460"></a><span class="c1"># Script ccpe-singularity</span>
<a id="__codelineno-1-461" name="__codelineno-1-461" href="#__codelineno-1-461"></a><span class="c1">#</span>
<a id="__codelineno-1-462" name="__codelineno-1-462" href="#__codelineno-1-462"></a><span class="c1"># Run singularity with proper initialisation.</span>
<a id="__codelineno-1-463" name="__codelineno-1-463" href="#__codelineno-1-463"></a><span class="c1">#</span>
<a id="__codelineno-1-464" name="__codelineno-1-464" href="#__codelineno-1-464"></a><span class="n">local_ccpe_singularity</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-465" name="__codelineno-1-465" href="#__codelineno-1-465"></a><span class="s2">#!/bin/bash</span>
<a id="__codelineno-1-466" name="__codelineno-1-466" href="#__codelineno-1-466"></a>
<a id="__codelineno-1-467" name="__codelineno-1-467" href="#__codelineno-1-467"></a><span class="s2">source %(installdir)s/config/clearLmod-save</span>
<a id="__codelineno-1-468" name="__codelineno-1-468" href="#__codelineno-1-468"></a>
<a id="__codelineno-1-469" name="__codelineno-1-469" href="#__codelineno-1-469"></a><span class="s2">if [ &quot;$CCPE_VERSION&quot; != &quot;</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">&quot; ]</span>
<a id="__codelineno-1-470" name="__codelineno-1-470" href="#__codelineno-1-470"></a><span class="s2">then</span>
<a id="__codelineno-1-471" name="__codelineno-1-471" href="#__codelineno-1-471"></a><span class="s2">    clearLmod-save $</span><span class="se">{{</span><span class="s2">EXPORTCCPE//,/ </span><span class="se">}}</span>
<a id="__codelineno-1-472" name="__codelineno-1-472" href="#__codelineno-1-472"></a><span class="s2">fi</span>
<a id="__codelineno-1-473" name="__codelineno-1-473" href="#__codelineno-1-473"></a>
<a id="__codelineno-1-474" name="__codelineno-1-474" href="#__codelineno-1-474"></a><span class="s2">singularity &quot;$@&quot;</span>
<a id="__codelineno-1-475" name="__codelineno-1-475" href="#__codelineno-1-475"></a>
<a id="__codelineno-1-476" name="__codelineno-1-476" href="#__codelineno-1-476"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">$&#39;</span> <span class="p">)</span>
<a id="__codelineno-1-477" name="__codelineno-1-477" href="#__codelineno-1-477"></a>
<a id="__codelineno-1-478" name="__codelineno-1-478" href="#__codelineno-1-478"></a>
<a id="__codelineno-1-479" name="__codelineno-1-479" href="#__codelineno-1-479"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-480" name="__codelineno-1-480" href="#__codelineno-1-480"></a><span class="c1">#</span>
<a id="__codelineno-1-481" name="__codelineno-1-481" href="#__codelineno-1-481"></a><span class="c1"># EasyBuild build commands</span>
<a id="__codelineno-1-482" name="__codelineno-1-482" href="#__codelineno-1-482"></a><span class="c1">#</span>
<a id="__codelineno-1-483" name="__codelineno-1-483" href="#__codelineno-1-483"></a><span class="n">postinstallcmds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-484" name="__codelineno-1-484" href="#__codelineno-1-484"></a>    <span class="c1"># First copy files that we want to inject in the container</span>
<a id="__codelineno-1-485" name="__codelineno-1-485" href="#__codelineno-1-485"></a>    <span class="s1">&#39;mkdir -p </span><span class="si">%(installdir)s</span><span class="s1">/config&#39;</span><span class="p">,</span>
<a id="__codelineno-1-486" name="__codelineno-1-486" href="#__codelineno-1-486"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/config/runscript &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_runscript</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-487" name="__codelineno-1-487" href="#__codelineno-1-487"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/config/runscript&#39;</span><span class="p">,</span>
<a id="__codelineno-1-488" name="__codelineno-1-488" href="#__codelineno-1-488"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/config/99-z-init-ccpe.sh &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_99_z_ccpe_init</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-489" name="__codelineno-1-489" href="#__codelineno-1-489"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/config/99-z-init-ccpe.sh&#39;</span><span class="p">,</span>
<a id="__codelineno-1-490" name="__codelineno-1-490" href="#__codelineno-1-490"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/config/bash.bashrc.local &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_bashrc_local</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-491" name="__codelineno-1-491" href="#__codelineno-1-491"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/config/bash.bashrc.local&#39;</span><span class="p">,</span>
<a id="__codelineno-1-492" name="__codelineno-1-492" href="#__codelineno-1-492"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/config/profile.local &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_profile_local</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-493" name="__codelineno-1-493" href="#__codelineno-1-493"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/config/profile.local&#39;</span><span class="p">,</span>
<a id="__codelineno-1-494" name="__codelineno-1-494" href="#__codelineno-1-494"></a>    <span class="c1"># Now create the definition file</span>
<a id="__codelineno-1-495" name="__codelineno-1-495" href="#__codelineno-1-495"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/config/ccpe-additional-packages.def &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_container_def</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-496" name="__codelineno-1-496" href="#__codelineno-1-496"></a>    <span class="s1">&#39;chmod a+r </span><span class="si">%(installdir)s</span><span class="s1">/config/ccpe-additional-packages.def&#39;</span><span class="p">,</span>
<a id="__codelineno-1-497" name="__codelineno-1-497" href="#__codelineno-1-497"></a>    <span class="c1">#&#39;false&#39;,</span>
<a id="__codelineno-1-498" name="__codelineno-1-498" href="#__codelineno-1-498"></a>    <span class="c1"># Build the container</span>
<a id="__codelineno-1-499" name="__codelineno-1-499" href="#__codelineno-1-499"></a>    <span class="c1"># We need to bind Slurm to keep the license check happy?</span>
<a id="__codelineno-1-500" name="__codelineno-1-500" href="#__codelineno-1-500"></a>    <span class="sa">f</span><span class="s1">&#39;cd %(installdir)s &amp;&amp; SINGULARITY_CACHEDIR=/tmp SINGULARITY_TMPDIR=/tmp singularity build --force </span><span class="si">{</span><span class="n">local_sif</span><span class="si">}</span><span class="s1"> %(installdir)s/config/ccpe-additional-packages.def&#39;</span><span class="p">,</span>
<a id="__codelineno-1-501" name="__codelineno-1-501" href="#__codelineno-1-501"></a>    <span class="c1"># Install scripts that run outside the container</span>
<a id="__codelineno-1-502" name="__codelineno-1-502" href="#__codelineno-1-502"></a>    <span class="s1">&#39;mkdir -p </span><span class="si">%(installdir)s</span><span class="s1">/bin&#39;</span><span class="p">,</span>
<a id="__codelineno-1-503" name="__codelineno-1-503" href="#__codelineno-1-503"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/config/clearLmod-save &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_clearLmod_save</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-504" name="__codelineno-1-504" href="#__codelineno-1-504"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/config/clearLmod-save&#39;</span><span class="p">,</span>
<a id="__codelineno-1-505" name="__codelineno-1-505" href="#__codelineno-1-505"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/bin/ccpe-shell &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_ccpe_shell</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-506" name="__codelineno-1-506" href="#__codelineno-1-506"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/bin/ccpe-shell&#39;</span><span class="p">,</span>
<a id="__codelineno-1-507" name="__codelineno-1-507" href="#__codelineno-1-507"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/bin/ccpe-exec &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_ccpe_exec</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-508" name="__codelineno-1-508" href="#__codelineno-1-508"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/bin/ccpe-exec&#39;</span><span class="p">,</span>
<a id="__codelineno-1-509" name="__codelineno-1-509" href="#__codelineno-1-509"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/bin/ccpe-run &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_ccpe_run</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-510" name="__codelineno-1-510" href="#__codelineno-1-510"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/bin/ccpe-run&#39;</span><span class="p">,</span>
<a id="__codelineno-1-511" name="__codelineno-1-511" href="#__codelineno-1-511"></a>    <span class="sa">f</span><span class="s1">&#39;cat &gt;%(installdir)s/bin/ccpe-singularity &lt;&lt;EOF </span><span class="si">{</span><span class="n">local_ccpe_singularity</span><span class="si">}</span><span class="s1">EOF&#39;</span><span class="p">,</span>
<a id="__codelineno-1-512" name="__codelineno-1-512" href="#__codelineno-1-512"></a>    <span class="s1">&#39;chmod a+rx </span><span class="si">%(installdir)s</span><span class="s1">/bin/ccpe-singularity&#39;</span><span class="p">,</span>
<a id="__codelineno-1-513" name="__codelineno-1-513" href="#__codelineno-1-513"></a><span class="p">]</span>
<a id="__codelineno-1-514" name="__codelineno-1-514" href="#__codelineno-1-514"></a>
<a id="__codelineno-1-515" name="__codelineno-1-515" href="#__codelineno-1-515"></a><span class="n">sanity_check_paths</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-1-516" name="__codelineno-1-516" href="#__codelineno-1-516"></a>    <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">local_sif</span><span class="p">],</span>
<a id="__codelineno-1-517" name="__codelineno-1-517" href="#__codelineno-1-517"></a>    <span class="s1">&#39;dirs&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">],</span>
<a id="__codelineno-1-518" name="__codelineno-1-518" href="#__codelineno-1-518"></a><span class="p">}</span>
<a id="__codelineno-1-519" name="__codelineno-1-519" href="#__codelineno-1-519"></a>
<a id="__codelineno-1-520" name="__codelineno-1-520" href="#__codelineno-1-520"></a><span class="n">local_expected_cce</span> <span class="o">=</span> <span class="s1">&#39;19.0.0&#39;</span>
<a id="__codelineno-1-521" name="__codelineno-1-521" href="#__codelineno-1-521"></a>
<a id="__codelineno-1-522" name="__codelineno-1-522" href="#__codelineno-1-522"></a><span class="n">sanity_check_commands</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-523" name="__codelineno-1-523" href="#__codelineno-1-523"></a>    <span class="c1"># Test if rocm was installed in the container. I&#39;ve seen zypper fail without stopping the container build...</span>
<a id="__codelineno-1-524" name="__codelineno-1-524" href="#__codelineno-1-524"></a>    <span class="s1">&#39;echo &quot;INFO: Checking for /opt/rocm/bin&quot;; ccpe-exec test -d /opt/rocm/bin&#39;</span><span class="p">,</span>
<a id="__codelineno-1-525" name="__codelineno-1-525" href="#__codelineno-1-525"></a>    <span class="c1"># Test for one of the last applications we installed through zypper before rocm.</span>
<a id="__codelineno-1-526" name="__codelineno-1-526" href="#__codelineno-1-526"></a>    <span class="s1">&#39;echo &quot;INFO: Checking for /usr/bin/vim&quot;; ccpe-exec test -f /usr/bin/vim&#39;</span><span class="p">,</span> 
<a id="__codelineno-1-527" name="__codelineno-1-527" href="#__codelineno-1-527"></a>    <span class="c1"># The next test will check if modules are correctly initialised and if the correct cce</span>
<a id="__codelineno-1-528" name="__codelineno-1-528" href="#__codelineno-1-528"></a>    <span class="c1"># module is present.</span>
<a id="__codelineno-1-529" name="__codelineno-1-529" href="#__codelineno-1-529"></a>    <span class="sa">f</span><span class="s1">&#39;echo &quot;INFO: Testing if cce/</span><span class="si">{</span><span class="n">local_expected_cce</span><span class="si">}</span><span class="s1"> is present&quot; ; ccpe-singularity exec &quot;$SIFCCPE&quot; bash -i -c </span><span class="se">\&#39;</span><span class="s1">module --terse list</span><span class="se">\&#39;</span><span class="s1"> |&amp; grep -q &quot;cce/</span><span class="si">{</span><span class="n">local_expected_cce</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-1-530" name="__codelineno-1-530" href="#__codelineno-1-530"></a>    <span class="c1"># Check if libfabric is loaded correctly and if it is the version of the system.</span>
<a id="__codelineno-1-531" name="__codelineno-1-531" href="#__codelineno-1-531"></a>    <span class="s1">&#39;echo &quot;INFO: Checking if the system libfabric is loaded by default.&quot; ; module load libfabric &amp;&amp; test $(ccpe-singularity exec &quot;$SIFCCPE&quot; bash -i -c </span><span class="se">\&#39;</span><span class="s1">module --terse list</span><span class="se">\&#39;</span><span class="s1"> |&amp; grep &quot;libfabric&quot;) = $(module --terse list |&amp; grep &quot;libfabric&quot;)&#39;</span><span class="p">,</span>  
<a id="__codelineno-1-532" name="__codelineno-1-532" href="#__codelineno-1-532"></a>    <span class="c1"># Check if the CXI provider is found.</span>
<a id="__codelineno-1-533" name="__codelineno-1-533" href="#__codelineno-1-533"></a>    <span class="s1">&#39;echo &quot;INFO: Checking for the CXI provider.&quot; ; ccpe-singularity exec &quot;$SIFCCPE&quot; bash -i -c </span><span class="se">\&#39;</span><span class="s1">fi_info</span><span class="se">\&#39;</span><span class="s1"> | egrep -q &quot;provider:[[:space:]]+cxi&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-1-534" name="__codelineno-1-534" href="#__codelineno-1-534"></a>    <span class="c1"># Test of the Slurm integration</span>
<a id="__codelineno-1-535" name="__codelineno-1-535" href="#__codelineno-1-535"></a>    <span class="s1">&#39;echo &quot;INFO: Checking Slurm sinfo command.&quot; ; ccpe-exec sinfo | grep -q standard-g&#39;</span><span class="p">,</span>
<a id="__codelineno-1-536" name="__codelineno-1-536" href="#__codelineno-1-536"></a>    <span class="c1">#</span>
<a id="__codelineno-1-537" name="__codelineno-1-537" href="#__codelineno-1-537"></a>    <span class="c1"># Tried testing with ccpe-run or ccpe-singularity run also but for some reason, this does not work in Easybuild,</span>
<a id="__codelineno-1-538" name="__codelineno-1-538" href="#__codelineno-1-538"></a>    <span class="c1"># and the runscript gets stuck, possibly trying to use a terminal which is not there. So even though running</span>
<a id="__codelineno-1-539" name="__codelineno-1-539" href="#__codelineno-1-539"></a>    <span class="c1"># something with `singularity run` seems to work on the command line, it may not work in batch mode.</span>
<a id="__codelineno-1-540" name="__codelineno-1-540" href="#__codelineno-1-540"></a><span class="p">]</span>
<a id="__codelineno-1-541" name="__codelineno-1-541" href="#__codelineno-1-541"></a>
<a id="__codelineno-1-542" name="__codelineno-1-542" href="#__codelineno-1-542"></a>
<a id="__codelineno-1-543" name="__codelineno-1-543" href="#__codelineno-1-543"></a><span class="c1">################################################################################</span>
<a id="__codelineno-1-544" name="__codelineno-1-544" href="#__codelineno-1-544"></a><span class="c1">#</span>
<a id="__codelineno-1-545" name="__codelineno-1-545" href="#__codelineno-1-545"></a><span class="c1"># Custom module that does a lot of the magic.</span>
<a id="__codelineno-1-546" name="__codelineno-1-546" href="#__codelineno-1-546"></a><span class="c1">#</span>
<a id="__codelineno-1-547" name="__codelineno-1-547" href="#__codelineno-1-547"></a><span class="n">modextravars</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-1-548" name="__codelineno-1-548" href="#__codelineno-1-548"></a>    <span class="s1">&#39;SIF&#39;</span><span class="p">:</span>                <span class="s1">&#39;</span><span class="si">%(installdir)s</span><span class="s1">/&#39;</span> <span class="o">+</span> <span class="n">local_sif</span><span class="p">,</span>
<a id="__codelineno-1-549" name="__codelineno-1-549" href="#__codelineno-1-549"></a>    <span class="s1">&#39;SIFCCPE&#39;</span><span class="p">:</span>            <span class="s1">&#39;</span><span class="si">%(installdir)s</span><span class="s1">/&#39;</span> <span class="o">+</span> <span class="n">local_sif</span><span class="p">,</span>
<a id="__codelineno-1-550" name="__codelineno-1-550" href="#__codelineno-1-550"></a>    <span class="c1"># The next line is very tricky as both Python and LUA interpret escape sequences in this string.</span>
<a id="__codelineno-1-551" name="__codelineno-1-551" href="#__codelineno-1-551"></a>    <span class="c1"># In the shell, we want PS1=&#39;\[\e[91m\]Container::\[\e[00m\] \u@\h:\w &gt;&#39;</span>
<a id="__codelineno-1-552" name="__codelineno-1-552" href="#__codelineno-1-552"></a>    <span class="c1"># In Lmod, we need setenv( &#39;SINGULARITYENV_PS1&#39;, &#39;\\[\\e[91m\\]Container::\\[\\e[00m\\] \\u@\\h:\\w &gt; &#39; )</span>
<a id="__codelineno-1-553" name="__codelineno-1-553" href="#__codelineno-1-553"></a>    <span class="c1"># And in Python for EasyBuild, this then becomes:</span>
<a id="__codelineno-1-554" name="__codelineno-1-554" href="#__codelineno-1-554"></a>    <span class="s1">&#39;SINGULARITYENV_PS1&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">[</span><span class="se">\\\\</span><span class="s1">e[91m</span><span class="se">\\\\</span><span class="s1">]Container::</span><span class="se">\\\\</span><span class="s1">[</span><span class="se">\\\\</span><span class="s1">e[00m</span><span class="se">\\\\</span><span class="s1">] </span><span class="se">\\\\</span><span class="s1">u@</span><span class="se">\\\\</span><span class="s1">h:</span><span class="se">\\\\</span><span class="s1">w &gt; &#39;</span><span class="p">,</span>
<a id="__codelineno-1-555" name="__codelineno-1-555" href="#__codelineno-1-555"></a>    <span class="s1">&#39;EXPORTCCPE&#39;</span><span class="p">:</span>         <span class="s1">&#39;SINGULARITY_BIND,SIF,SIFCCPE,SWITCHTOCCPE,EXPORTCCPE,SINGULARITYENV_PS1&#39;</span><span class="p">,</span>
<a id="__codelineno-1-556" name="__codelineno-1-556" href="#__codelineno-1-556"></a>    <span class="c1">#&#39;SBATCH_EXPORT&#39;:      &#39;SINGULARITY_BIND,SWITHCTOCCPE,SIF,SIFCCPE&#39;,</span>
<a id="__codelineno-1-557" name="__codelineno-1-557" href="#__codelineno-1-557"></a>    <span class="c1">#&#39;SLURM_EXPORT_ENV&#39;:   &#39;SINGULARITY_BIND,SWITHCTOCCPE,SIF,SIFCCPE&#39;, # In case srun is called directly</span>
<a id="__codelineno-1-558" name="__codelineno-1-558" href="#__codelineno-1-558"></a>    <span class="c1">#&#39;SWITCHTOCCPE&#39;:       # Have to do this in modluafooter as we need multi-line strings for readability of the code.</span>
<a id="__codelineno-1-559" name="__codelineno-1-559" href="#__codelineno-1-559"></a><span class="p">}</span>
<a id="__codelineno-1-560" name="__codelineno-1-560" href="#__codelineno-1-560"></a>
<a id="__codelineno-1-561" name="__codelineno-1-561" href="#__codelineno-1-561"></a><span class="n">local_singularity_bind</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="c1"># Add bindings here!</span>
<a id="__codelineno-1-562" name="__codelineno-1-562" href="#__codelineno-1-562"></a>    <span class="c1"># Files generated by this EasyConfig</span>
<a id="__codelineno-1-563" name="__codelineno-1-563" href="#__codelineno-1-563"></a>    <span class="c1"># The following ones are injected in the container already.</span>
<a id="__codelineno-1-564" name="__codelineno-1-564" href="#__codelineno-1-564"></a>    <span class="c1">#&#39;%(installdir)s/config/runscript:/.singularity.d/runscript&#39;,                    # Overwrite the runscript</span>
<a id="__codelineno-1-565" name="__codelineno-1-565" href="#__codelineno-1-565"></a>    <span class="c1">#&#39;%(installdir)s/config/99-z-init-ccpe.sh:/.singularity.d/env/99-z-init-ccpe.sh&#39;, # Set INITCCPE </span>
<a id="__codelineno-1-566" name="__codelineno-1-566" href="#__codelineno-1-566"></a>    <span class="c1">#&#39;%(installdir)s/config/bash.bashrc.local:/etc/bash.bashrc.local&#39;,                # Properly initialise the module environment</span>
<a id="__codelineno-1-567" name="__codelineno-1-567" href="#__codelineno-1-567"></a>    <span class="c1">#&#39;%(installdir)s/config/profile.local:/etc/profile.local&#39;,                        # For possible future use, currently empty</span>
<a id="__codelineno-1-568" name="__codelineno-1-568" href="#__codelineno-1-568"></a>
<a id="__codelineno-1-569" name="__codelineno-1-569" href="#__codelineno-1-569"></a>    <span class="c1"># Lustre storage</span>
<a id="__codelineno-1-570" name="__codelineno-1-570" href="#__codelineno-1-570"></a>    <span class="s1">&#39;/pfs&#39;</span><span class="p">,</span>
<a id="__codelineno-1-571" name="__codelineno-1-571" href="#__codelineno-1-571"></a>    <span class="s1">&#39;/users&#39;</span><span class="p">,</span>
<a id="__codelineno-1-572" name="__codelineno-1-572" href="#__codelineno-1-572"></a>    <span class="s1">&#39;/projappl&#39;</span><span class="p">,</span>
<a id="__codelineno-1-573" name="__codelineno-1-573" href="#__codelineno-1-573"></a>    <span class="s1">&#39;/project&#39;</span><span class="p">,</span>
<a id="__codelineno-1-574" name="__codelineno-1-574" href="#__codelineno-1-574"></a>    <span class="s1">&#39;/scratch&#39;</span><span class="p">,</span>
<a id="__codelineno-1-575" name="__codelineno-1-575" href="#__codelineno-1-575"></a>    <span class="s1">&#39;/flash&#39;</span><span class="p">,</span>
<a id="__codelineno-1-576" name="__codelineno-1-576" href="#__codelineno-1-576"></a>    <span class="s1">&#39;/appl/local&#39;</span><span class="p">,</span>
<a id="__codelineno-1-577" name="__codelineno-1-577" href="#__codelineno-1-577"></a>    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">local_appl_lumi</span><span class="si">}</span><span class="s1">:/appl/lumi&#39;</span><span class="p">,</span>
<a id="__codelineno-1-578" name="__codelineno-1-578" href="#__codelineno-1-578"></a>
<a id="__codelineno-1-579" name="__codelineno-1-579" href="#__codelineno-1-579"></a>    <span class="c1"># ROCm is included in this container, so the next block is not needed.</span>
<a id="__codelineno-1-580" name="__codelineno-1-580" href="#__codelineno-1-580"></a>    <span class="c1"># Customize these locations per-system</span>
<a id="__codelineno-1-581" name="__codelineno-1-581" href="#__codelineno-1-581"></a>    <span class="c1"># GPU SDK mounts</span>
<a id="__codelineno-1-582" name="__codelineno-1-582" href="#__codelineno-1-582"></a>    <span class="c1"># Customize these locations per-system</span>
<a id="__codelineno-1-583" name="__codelineno-1-583" href="#__codelineno-1-583"></a>    <span class="c1">#&#39;/opt/cray/pe/lmod/modulefiles/core/rocm/6.0.3.lua&#39;, # module --loc --redirect show rocm</span>
<a id="__codelineno-1-584" name="__codelineno-1-584" href="#__codelineno-1-584"></a>    <span class="c1">#&#39;/opt/cray/pe/lmod/modulefiles/core/amd/6.0.3.lua&#39;,  # module --loc --redirect show amd</span>
<a id="__codelineno-1-585" name="__codelineno-1-585" href="#__codelineno-1-585"></a>    <span class="c1">#&#39;/opt/rocm-6.0.3&#39;,                                   # module --redirect show rocm | grep ROCM_PATH | awk -F&#39;&quot;&#39; &#39;{ print $4 }&#39;</span>
<a id="__codelineno-1-586" name="__codelineno-1-586" href="#__codelineno-1-586"></a>    <span class="c1">#&#39;/usr/lib64/pkgconfig/rocm-6.0.3.pc&#39;,                # echo &quot;$(module --redirect show rocm | grep PKG_CONFIG_PATH | awk -F&#39;&quot;&#39; &#39;{ print $4 }&#39;)/$(module --redirect show rocm | grep PE_PKGCONFIG_LIBS | awk -F&#39;&quot;&#39; &#39;{ print $4 }&#39;).pc&quot;</span>
<a id="__codelineno-1-587" name="__codelineno-1-587" href="#__codelineno-1-587"></a>    <span class="c1"># Do we need to bind /dev/kfd and /dev/dri? They seem to be in the container by default.</span>
<a id="__codelineno-1-588" name="__codelineno-1-588" href="#__codelineno-1-588"></a>
<a id="__codelineno-1-589" name="__codelineno-1-589" href="#__codelineno-1-589"></a>    <span class="c1"># System libfabric install: Different from the ccpe-config script as that was for Red Hat</span>
<a id="__codelineno-1-590" name="__codelineno-1-590" href="#__codelineno-1-590"></a>    <span class="c1"># For the modules, binding the specific version is not enough as that would leave the newer</span>
<a id="__codelineno-1-591" name="__codelineno-1-591" href="#__codelineno-1-591"></a>    <span class="c1"># module in the container.</span>
<a id="__codelineno-1-592" name="__codelineno-1-592" href="#__codelineno-1-592"></a>    <span class="s1">&#39;/opt/cray/libfabric/1.15.2.0&#39;</span><span class="p">,</span>    <span class="c1"># module --redirect show libfabric | grep &#39;&quot;PATH&quot;&#39; | awk -F&#39;&quot;&#39; &#39;{ print $4 }&#39; | sed -e &#39;s|/bin||&#39;</span>
<a id="__codelineno-1-593" name="__codelineno-1-593" href="#__codelineno-1-593"></a>    <span class="s1">&#39;/opt/cray/modulefiles/libfabric&#39;</span><span class="p">,</span> <span class="c1"># module --loc --redirect show libfabric | sed -e &#39;s|\(.*libfabric.*\)/.*|\1|&#39;</span>
<a id="__codelineno-1-594" name="__codelineno-1-594" href="#__codelineno-1-594"></a>    <span class="s1">&#39;/usr/lib64/libcxi.so.1&#39;</span><span class="p">,</span>          <span class="c1"># ldd $(module --redirect show libfabric | grep &#39;&quot;LD_LIBRARY_PATH&quot;&#39; | awk -F&#39;&quot;&#39; &#39;{ print $4 }&#39;)/libfabric.so | grep libcxi | awk &#39;{print $3}&#39;</span>
<a id="__codelineno-1-595" name="__codelineno-1-595" href="#__codelineno-1-595"></a>
<a id="__codelineno-1-596" name="__codelineno-1-596" href="#__codelineno-1-596"></a>    <span class="c1"># XPMEM binding</span>
<a id="__codelineno-1-597" name="__codelineno-1-597" href="#__codelineno-1-597"></a>    <span class="s1">&#39;/opt/cray/modulefiles/xpmem/2.8.2-1.0_5.1__g84a27a5.shasta&#39;</span><span class="p">,</span>  <span class="c1"># module --loc --redirect show xpmem</span>
<a id="__codelineno-1-598" name="__codelineno-1-598" href="#__codelineno-1-598"></a>    <span class="s1">&#39;/opt/cray/xpmem&#39;</span><span class="p">,</span>                                             <span class="c1"># echo $(dirname `pkg-config --variable=prefix cray-xpmem`)</span>
<a id="__codelineno-1-599" name="__codelineno-1-599" href="#__codelineno-1-599"></a>    <span class="s1">&#39;/usr/lib64/pkgconfig/cray-xpmem.pc&#39;</span><span class="p">,</span>                          <span class="c1"># echo &quot;$(pkg-config --variable=pcfiledir cray-xpmem)/cray-xpmem.pc&quot;</span>
<a id="__codelineno-1-600" name="__codelineno-1-600" href="#__codelineno-1-600"></a>
<a id="__codelineno-1-601" name="__codelineno-1-601" href="#__codelineno-1-601"></a>    <span class="c1"># Do we need PALs on LUMI? Yes, as several libraries link it even though it is probably not used.</span>
<a id="__codelineno-1-602" name="__codelineno-1-602" href="#__codelineno-1-602"></a>    <span class="c1"># echo $(dirname `module --redirect show cray-pals | grep PATH | awk -F&#39;&quot;&#39; &#39;{ print $4 }&#39; | tail -n 1`)</span>
<a id="__codelineno-1-603" name="__codelineno-1-603" href="#__codelineno-1-603"></a>    <span class="c1"># &#39;/usr/lib64/libjansson.so.4&#39;, </span>
<a id="__codelineno-1-604" name="__codelineno-1-604" href="#__codelineno-1-604"></a>
<a id="__codelineno-1-605" name="__codelineno-1-605" href="#__codelineno-1-605"></a>    <span class="c1"># System mounts - List from Alfio webinar</span>
<a id="__codelineno-1-606" name="__codelineno-1-606" href="#__codelineno-1-606"></a>    <span class="s1">&#39;/var/spool&#39;</span><span class="p">,</span>
<a id="__codelineno-1-607" name="__codelineno-1-607" href="#__codelineno-1-607"></a>    <span class="s1">&#39;/run/cxi&#39;</span><span class="p">,</span>
<a id="__codelineno-1-608" name="__codelineno-1-608" href="#__codelineno-1-608"></a>    <span class="s1">&#39;/etc/host.conf&#39;</span><span class="p">,</span>
<a id="__codelineno-1-609" name="__codelineno-1-609" href="#__codelineno-1-609"></a>    <span class="s1">&#39;/etc/nsswitch.conf&#39;</span><span class="p">,</span>
<a id="__codelineno-1-610" name="__codelineno-1-610" href="#__codelineno-1-610"></a>    <span class="s1">&#39;/etc/resolv.conf&#39;</span><span class="p">,</span>
<a id="__codelineno-1-611" name="__codelineno-1-611" href="#__codelineno-1-611"></a>    <span class="s1">&#39;/etc/ssl/openssl.cnf&#39;</span><span class="p">,</span>
<a id="__codelineno-1-612" name="__codelineno-1-612" href="#__codelineno-1-612"></a>    <span class="c1"># Additional one for the specific setup of the container in this module</span>
<a id="__codelineno-1-613" name="__codelineno-1-613" href="#__codelineno-1-613"></a>    <span class="s1">&#39;/etc/cray-pe.d/cray-pe-configuration.sh&#39;</span><span class="p">,</span>
<a id="__codelineno-1-614" name="__codelineno-1-614" href="#__codelineno-1-614"></a>
<a id="__codelineno-1-615" name="__codelineno-1-615" href="#__codelineno-1-615"></a>    <span class="c1"># Slurm mounts</span>
<a id="__codelineno-1-616" name="__codelineno-1-616" href="#__codelineno-1-616"></a>    <span class="s1">&#39;/etc/slurm&#39;</span><span class="p">,</span> <span class="c1"># Even if Slurm support does not yet work, we need this to detect we&#39;re on LUMI.</span>
<a id="__codelineno-1-617" name="__codelineno-1-617" href="#__codelineno-1-617"></a>    <span class="s1">&#39;/usr/bin/sacct&#39;</span><span class="p">,</span>
<a id="__codelineno-1-618" name="__codelineno-1-618" href="#__codelineno-1-618"></a>    <span class="s1">&#39;/usr/bin/salloc&#39;</span><span class="p">,</span>
<a id="__codelineno-1-619" name="__codelineno-1-619" href="#__codelineno-1-619"></a>    <span class="s1">&#39;/usr/bin/sattach&#39;</span><span class="p">,</span>
<a id="__codelineno-1-620" name="__codelineno-1-620" href="#__codelineno-1-620"></a>    <span class="s1">&#39;/usr/bin/sbatch&#39;</span><span class="p">,</span>
<a id="__codelineno-1-621" name="__codelineno-1-621" href="#__codelineno-1-621"></a>    <span class="s1">&#39;/usr/bin/sbcast&#39;</span><span class="p">,</span>
<a id="__codelineno-1-622" name="__codelineno-1-622" href="#__codelineno-1-622"></a>    <span class="s1">&#39;/usr/bin/scontrol&#39;</span><span class="p">,</span>
<a id="__codelineno-1-623" name="__codelineno-1-623" href="#__codelineno-1-623"></a>    <span class="s1">&#39;/usr/bin/sinfo&#39;</span><span class="p">,</span>
<a id="__codelineno-1-624" name="__codelineno-1-624" href="#__codelineno-1-624"></a>    <span class="s1">&#39;/usr/bin/squeue&#39;</span><span class="p">,</span>
<a id="__codelineno-1-625" name="__codelineno-1-625" href="#__codelineno-1-625"></a>    <span class="s1">&#39;/usr/bin/srun&#39;</span><span class="p">,</span>
<a id="__codelineno-1-626" name="__codelineno-1-626" href="#__codelineno-1-626"></a>    <span class="s1">&#39;/usr/lib64/slurm&#39;</span><span class="p">,</span>
<a id="__codelineno-1-627" name="__codelineno-1-627" href="#__codelineno-1-627"></a>    <span class="s1">&#39;/var/spool/slurmd&#39;</span><span class="p">,</span>
<a id="__codelineno-1-628" name="__codelineno-1-628" href="#__codelineno-1-628"></a>    <span class="s1">&#39;/var/run/munge&#39;</span><span class="p">,</span>
<a id="__codelineno-1-629" name="__codelineno-1-629" href="#__codelineno-1-629"></a>    <span class="s1">&#39;/usr/lib64/libmunge.so.2&#39;</span><span class="p">,</span>
<a id="__codelineno-1-630" name="__codelineno-1-630" href="#__codelineno-1-630"></a>    <span class="s1">&#39;/usr/lib64/libmunge.so.2.0.0&#39;</span><span class="p">,</span>
<a id="__codelineno-1-631" name="__codelineno-1-631" href="#__codelineno-1-631"></a>    <span class="s1">&#39;/usr/include/slurm&#39;</span><span class="p">,</span>
<a id="__codelineno-1-632" name="__codelineno-1-632" href="#__codelineno-1-632"></a>
<a id="__codelineno-1-633" name="__codelineno-1-633" href="#__codelineno-1-633"></a><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-1-634" name="__codelineno-1-634" href="#__codelineno-1-634"></a>
<a id="__codelineno-1-635" name="__codelineno-1-635" href="#__codelineno-1-635"></a><span class="n">modluafooter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-636" name="__codelineno-1-636" href="#__codelineno-1-636"></a>
<a id="__codelineno-1-637" name="__codelineno-1-637" href="#__codelineno-1-637"></a><span class="s2">-- Set the bind mounts</span>
<a id="__codelineno-1-638" name="__codelineno-1-638" href="#__codelineno-1-638"></a><span class="s2">prepend_path( &#39;SINGULARITY_BIND&#39;, &#39;</span><span class="si">{</span><span class="n">local_singularity_bind</span><span class="si">}</span><span class="s2">&#39;, &#39;,&#39; )</span>
<a id="__codelineno-1-639" name="__codelineno-1-639" href="#__codelineno-1-639"></a>
<a id="__codelineno-1-640" name="__codelineno-1-640" href="#__codelineno-1-640"></a><span class="s2">-- Inject some configuration files from LUMI.</span>
<a id="__codelineno-1-641" name="__codelineno-1-641" href="#__codelineno-1-641"></a><span class="s2">-- These are currently done in the main list (first one) or included in the container.</span>
<a id="__codelineno-1-642" name="__codelineno-1-642" href="#__codelineno-1-642"></a><span class="s2">-- prepend_path( &#39;SINGULARITY_BIND&#39;, &#39;/etc/cray-pe.d/cray-pe-configuration.sh:/etc/cray-pe.d/cray-pe-configuration.sh&#39;, &#39;,&#39; )</span>
<a id="__codelineno-1-643" name="__codelineno-1-643" href="#__codelineno-1-643"></a><span class="s2">-- prepend_path( &#39;SINGULARITY_BIND&#39;, &#39;%(installdir)s/config/99-z-init-ccpe.sh:/.singularity.d/env/99-z-init-ccpe.sh&#39;, &#39;,&#39; )</span>
<a id="__codelineno-1-644" name="__codelineno-1-644" href="#__codelineno-1-644"></a><span class="s2">-- prepend_path( &#39;SINGULARITY_BIND&#39;, &#39;%(installdir)s/config/bash.bashrc.local:/etc/bash.bashrc.local&#39;, &#39;,&#39; ) -- Or could chose to take the one from the system.</span>
<a id="__codelineno-1-645" name="__codelineno-1-645" href="#__codelineno-1-645"></a><span class="s2">-- prepend_path( &#39;SINGULARITY_BIND&#39;, &#39;%(installdir)s/config/profile.local:/etc/profile.local&#39;, &#39;,&#39; )</span>
<a id="__codelineno-1-646" name="__codelineno-1-646" href="#__codelineno-1-646"></a>
<a id="__codelineno-1-647" name="__codelineno-1-647" href="#__codelineno-1-647"></a><span class="s2">setenv( &#39;SWITCHTOCCPE&#39;, [==[</span>
<a id="__codelineno-1-648" name="__codelineno-1-648" href="#__codelineno-1-648"></a><span class="s2">if [ ! -d &quot;/.singularity.d&quot; ] ;</span>
<a id="__codelineno-1-649" name="__codelineno-1-649" href="#__codelineno-1-649"></a><span class="s2">then</span>
<a id="__codelineno-1-650" name="__codelineno-1-650" href="#__codelineno-1-650"></a>
<a id="__codelineno-1-651" name="__codelineno-1-651" href="#__codelineno-1-651"></a><span class="s2">    if [ &quot;$CCPE_VERSION&quot; != &quot;</span><span class="si">{</span><span class="n">local_ccpe_version</span><span class="si">}</span><span class="s2">&quot; ] ;</span>
<a id="__codelineno-1-652" name="__codelineno-1-652" href="#__codelineno-1-652"></a><span class="s2">    then</span>
<a id="__codelineno-1-653" name="__codelineno-1-653" href="#__codelineno-1-653"></a>
<a id="__codelineno-1-654" name="__codelineno-1-654" href="#__codelineno-1-654"></a><span class="s2">        for var in $</span><span class="se">{{</span><span class="s2">EXPORTCCPE//,/ </span><span class="se">}}</span><span class="s2"> ;</span>
<a id="__codelineno-1-655" name="__codelineno-1-655" href="#__codelineno-1-655"></a><span class="s2">        do</span>
<a id="__codelineno-1-656" name="__codelineno-1-656" href="#__codelineno-1-656"></a><span class="s2">            if [ -v $var ] ; </span>
<a id="__codelineno-1-657" name="__codelineno-1-657" href="#__codelineno-1-657"></a><span class="s2">            then</span>
<a id="__codelineno-1-658" name="__codelineno-1-658" href="#__codelineno-1-658"></a><span class="s2">                eval $(declare -p $var | sed -e &quot;s/$var/save_$var/&quot;) ;</span>
<a id="__codelineno-1-659" name="__codelineno-1-659" href="#__codelineno-1-659"></a><span class="s2">            fi ;</span>
<a id="__codelineno-1-660" name="__codelineno-1-660" href="#__codelineno-1-660"></a><span class="s2">        done ;</span>
<a id="__codelineno-1-661" name="__codelineno-1-661" href="#__codelineno-1-661"></a>
<a id="__codelineno-1-662" name="__codelineno-1-662" href="#__codelineno-1-662"></a><span class="s2">        module --force purge ;</span>
<a id="__codelineno-1-663" name="__codelineno-1-663" href="#__codelineno-1-663"></a><span class="s2">        eval $($LMOD_DIR/clearLMOD_cmd --shell bash --full --quiet) ;</span>
<a id="__codelineno-1-664" name="__codelineno-1-664" href="#__codelineno-1-664"></a><span class="s2">        unset LUMI_INIT_FIRST_LOAD ;</span>
<a id="__codelineno-1-665" name="__codelineno-1-665" href="#__codelineno-1-665"></a><span class="s2">        unset PROFILEREAD ;</span>
<a id="__codelineno-1-666" name="__codelineno-1-666" href="#__codelineno-1-666"></a>
<a id="__codelineno-1-667" name="__codelineno-1-667" href="#__codelineno-1-667"></a><span class="s2">        for var in $</span><span class="se">{{</span><span class="s2">save_EXPORTCCPE//,/ </span><span class="se">}}</span><span class="s2"> ;</span>
<a id="__codelineno-1-668" name="__codelineno-1-668" href="#__codelineno-1-668"></a><span class="s2">        do</span>
<a id="__codelineno-1-669" name="__codelineno-1-669" href="#__codelineno-1-669"></a><span class="s2">            varname=&quot;save_$var&quot; ;</span>
<a id="__codelineno-1-670" name="__codelineno-1-670" href="#__codelineno-1-670"></a><span class="s2">            if [ -v $varname ] ;</span>
<a id="__codelineno-1-671" name="__codelineno-1-671" href="#__codelineno-1-671"></a><span class="s2">            then</span>
<a id="__codelineno-1-672" name="__codelineno-1-672" href="#__codelineno-1-672"></a><span class="s2">                eval $(declare -p $varname | sed -e &quot;s/save_$var/$var/&quot;) ;</span>
<a id="__codelineno-1-673" name="__codelineno-1-673" href="#__codelineno-1-673"></a><span class="s2">                unset $varname ;</span>
<a id="__codelineno-1-674" name="__codelineno-1-674" href="#__codelineno-1-674"></a><span class="s2">            fi ;</span>
<a id="__codelineno-1-675" name="__codelineno-1-675" href="#__codelineno-1-675"></a><span class="s2">        done ;</span>
<a id="__codelineno-1-676" name="__codelineno-1-676" href="#__codelineno-1-676"></a>
<a id="__codelineno-1-677" name="__codelineno-1-677" href="#__codelineno-1-677"></a><span class="s2">    fi ;</span>
<a id="__codelineno-1-678" name="__codelineno-1-678" href="#__codelineno-1-678"></a>
<a id="__codelineno-1-679" name="__codelineno-1-679" href="#__codelineno-1-679"></a><span class="s2">    exec singularity exec &quot;$SIFCCPE&quot; &quot;$0&quot; &quot;$@&quot; ;</span>
<a id="__codelineno-1-680" name="__codelineno-1-680" href="#__codelineno-1-680"></a>
<a id="__codelineno-1-681" name="__codelineno-1-681" href="#__codelineno-1-681"></a><span class="s2">fi ;</span>
<a id="__codelineno-1-682" name="__codelineno-1-682" href="#__codelineno-1-682"></a>
<a id="__codelineno-1-683" name="__codelineno-1-683" href="#__codelineno-1-683"></a><span class="s2">eval $INITCCPE ;</span>
<a id="__codelineno-1-684" name="__codelineno-1-684" href="#__codelineno-1-684"></a>
<a id="__codelineno-1-685" name="__codelineno-1-685" href="#__codelineno-1-685"></a><span class="s2">unset SLURM_EXPORT_ENV ;</span>
<a id="__codelineno-1-686" name="__codelineno-1-686" href="#__codelineno-1-686"></a>
<a id="__codelineno-1-687" name="__codelineno-1-687" href="#__codelineno-1-687"></a><span class="s2">]==] )</span>
<a id="__codelineno-1-688" name="__codelineno-1-688" href="#__codelineno-1-688"></a>
<a id="__codelineno-1-689" name="__codelineno-1-689" href="#__codelineno-1-689"></a><span class="s2">-- if mode() == &#39;load&#39; then</span>
<a id="__codelineno-1-690" name="__codelineno-1-690" href="#__codelineno-1-690"></a><span class="s2">-- LmodMessage( [==[</span>
<a id="__codelineno-1-691" name="__codelineno-1-691" href="#__codelineno-1-691"></a><span class="s2">-- </span>
<a id="__codelineno-1-692" name="__codelineno-1-692" href="#__codelineno-1-692"></a><span class="s2">-- By using this container, you agree to the license</span>
<a id="__codelineno-1-693" name="__codelineno-1-693" href="#__codelineno-1-693"></a><span class="s2">-- https://downloads.hpe.com/pub/softlib2/software1/doc/p1796552785/v113125/eula-en.html .</span>
<a id="__codelineno-1-694" name="__codelineno-1-694" href="#__codelineno-1-694"></a><span class="s2">-- ]==] )</span>
<a id="__codelineno-1-695" name="__codelineno-1-695" href="#__codelineno-1-695"></a><span class="s2">-- end</span>
<a id="__codelineno-1-696" name="__codelineno-1-696" href="#__codelineno-1-696"></a>
<a id="__codelineno-1-697" name="__codelineno-1-697" href="#__codelineno-1-697"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-698" name="__codelineno-1-698" href="#__codelineno-1-698"></a>
<a id="__codelineno-1-699" name="__codelineno-1-699" href="#__codelineno-1-699"></a><span class="n">moduleclass</span> <span class="o">=</span> <span class="s1">&#39;devel&#39;</span>
</code></pre></div>
<p><a href="../">[ccpe]</a> <a href="../../../">[package list]</a></p>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        




<footer class="md-footer">

  
  

  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      
    <div class="md-footer-copyright">
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" 
             style="border-width:0" 
             src="https://i.creativecommons.org/l/by/4.0/80x15.png"
        />
      </a>
      This work is licensed under a&nbsp;
      <a rel="license" 
         href="http://creativecommons.org/licenses/by/4.0/"
      >
        Creative Commons Attribution 4.0 International License
      </a>
    </div>

      
      
<div class="md-social">
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UCb31KOJ6Wqu0sRpIRi_k8Mw" target="_blank" rel="noopener" title="LUMI on YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/lumi-supercomputer" target="_blank" rel="noopener" title="LUMI on LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/LUMIhpc" target="_blank" rel="noopener" title="LUMI on Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "toc.follow", "search.suggest", "content.code.annotate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>